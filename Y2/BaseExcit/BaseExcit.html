<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDOF Vibration with Base Excitation</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    
    <!-- MathJax for LaTeX rendering -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [['$$','$$'], ['\\[','\\]']],
          processEscapes: true
        }
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_HTML"></script>
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/problems.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/quizzes.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">
</head>
<body>
    <header>
        <h1>SDOF Vibration with Base Excitation</h1>
        <p class="small-caps">Interactive Lecture on Single Degree of Freedom Systems</p>
        <p>Dr. Arnaldo Delli Carri</p>
    </header>

    <div class="content-section">
        <h2>Introduction to Base Excitation</h2>
        <p>Base excitation is a fundamental concept in vibration engineering where a system is excited through motion of its support or foundation rather than by directly applying a force to the mass. This type of vibration is commonly encountered in:</p>
        <ul>
            <li>Vehicles driving over rough roads</li>
            <li>Buildings during earthquakes</li>
            <li>Electronic equipment mounted on vibrating platforms</li>
            <li>Machinery mounted on flexible foundations</li>
        </ul>

        <div class="key-point">
            <p><strong>Base excitation</strong> occurs when the input to a mechanical system is the motion of its base or foundation, rather than a force applied directly to the mass.</p>
        </div>

        <h3>The SDOF Model with Base Excitation</h3>
        <p>A Single Degree of Freedom (SDOF) system with base excitation consists of:</p>
        <ul>
            <li>A mass (m)</li>
            <li>A spring (k) connecting the mass to the base</li>
            <li>A damper (c) connecting the mass to the base</li>
            <li>Base motion (y(t)) which acts as the input to the system</li>
            <li>Mass motion (x(t)) which is the response of the system</li>
        </ul>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation</h2>
            <div id="sdof-sketch"></div>

            <div class="controls">
                <div class="slider-container">
                    <label for="mass-slider">Mass (m):</label>
                    <input type="range" id="mass-slider" min="1" max="10" step="0.1" value="2">
                    <span id="mass-value">2.0 kg</span>
                </div>

                <div class="slider-container">
                    <label for="stiffness-slider">Stiffness (k):</label>
                    <input type="range" id="stiffness-slider" min="100" max="2000" step="50" value="500">
                    <span id="stiffness-value">500 N/m</span>
                </div>

                <div class="slider-container">
                    <label for="damping-slider">Damping (c):</label>
                    <input type="range" id="damping-slider" min="0" max="50" step="1" value="10">
                    <span id="damping-value">10 Ns/m</span>
                </div>

                <div class="slider-container">
                    <label for="amplitude-slider">Base Amplitude:</label>
                    <input type="range" id="amplitude-slider" min="0" max="0.05" step="0.001" value="0.02">
                    <span id="amplitude-value">0.02 m</span>
                </div>

                <div class="slider-container">
                    <label for="frequency-slider">Excitation Frequency:</label>
                    <input type="range" id="frequency-slider" min="0.1" max="10" step="0.1" value="3.0">
                    <span id="frequency-value">3.0 Hz</span>
                </div>

                <div class="button-container">
                    <button id="start-button">Start</button>
                    <button id="reset-button">Reset</button>
                </div>
            </div>
    </div>

    <div class="content-section">
        <h2>Equation of Motion</h2>
        <p>To derive the equation of motion for a base-excited SDOF system, we need to identify all forces acting on the mass and apply Newton's Second Law.</p>

        <div class="equation-box">
            <p>For a mass m with absolute displacement x(t) and base with displacement y(t):</p>
            <p>Spring force: $F_s = k(x - y)$</p>
            <p>Damping force: $F_d = c(\dot{x} - \dot{y})$</p>
            <p>Using Newton's Second Law: $m\ddot{x} + c(\dot{x} - \dot{y}) + k(x - y) = 0$</p>
            <p>Rearranging: $m\ddot{x} + c\dot{x} + kx = c\dot{y} + ky$</p>
        </div>

        <p>If we define the relative displacement between the mass and the base as $z = x - y$, then:</p>

        <div class="equation-box">
            <p>$m\ddot{z} + c\dot{z} + kz = -m\ddot{y}$</p>
            <p>Where $-m\ddot{y}$ is the effective force applied to the mass due to base acceleration.</p>
        </div>

        <div class="key-point">
            <p>Unlike direct force excitation where the forcing term is the actual applied force, in base excitation the effective forcing term is proportional to the base acceleration multiplied by the mass.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Harmonic Base Excitation</h2>
        <p>When the base motion is harmonic (sinusoidal), we can express it as:</p>

        <div class="equation-box">
            <p>$y(t) = Y\sin(\omega t)$</p>
            <p>Where $Y$ is the amplitude of base motion and $\omega$ is the angular frequency.</p>
            <p>The acceleration of the base is: $\ddot{y}(t) = -Y\omega^2\sin(\omega t)$</p>
            <p>Substituting into the equation of motion:</p>
            <p>$m\ddot{z} + c\dot{z} + kz = m Y \omega^2 \sin(\omega t)$</p>
        </div>

        <p>The steady-state solution for the relative displacement is:</p>

        <div class="equation-box">
            <p>$z(t) = Z\sin(\omega t - \varphi)$</p>
            <p>Where $Z$ is the amplitude of relative motion and $\varphi$ is the phase angle between the base motion and the mass response.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Frequency Response and Transmissibility</h2>

        <h3>Displacement Transmissibility</h3>
        <p>Displacement transmissibility is the ratio of the amplitude of mass displacement to the amplitude of base displacement:</p>

        <div class="equation-box">
            <p>$T_d = \frac{|X|}{|Y|} = \sqrt{\frac{1+(2\zeta \rho)^2}{(1-\rho^2)^2+(2\zeta \rho)^2}}$</p>
            <p>Where:</p>
            <ul>
                <li>$\rho = \frac{\omega}{\omega_n}$ is the frequency ratio</li>
                <li>$\omega_n = \sqrt{\frac{k}{m}}$ is the natural frequency</li>
                <li>$\zeta = \frac{c}{2\sqrt{km}}$ is the damping ratio</li>
            </ul>
        </div>

        <h3>Force Transmissibility</h3>
        <p>Force transmissibility is the ratio of the force transmitted to the foundation to the force generated by the base motion:</p>

        <div class="equation-box">
            <p>$T_f = \frac{F_{transmitted}}{F_{base}} = \sqrt{\frac{1+(2\zeta \rho)^2}{(1-\rho^2)^2+(2\zeta \rho)^2}}$</p>
            <p>This has the same mathematical form as displacement transmissibility.</p>
        </div>

        <div class="key-point">
            <p><strong>Important Observations:</strong></p>
            <ul>
                <li>When $\rho < \sqrt{2}$, the transmissibility is greater than 1, meaning the motion is amplified</li>
                <li>When $\rho > \sqrt{2}$, the transmissibility is less than 1, meaning the motion is attenuated</li>
                <li>For $\rho \gg 1$ (high frequencies), transmissibility approaches $\frac{1}{\rho^2}$</li>
                <li>Increasing damping reduces the peak transmissibility but can increase transmissibility at high frequencies</li>
            </ul>
        </div>
    </div>

    <div class="content-section">
        <h2>Random Vibration and Power Spectral Density</h2>

        <p>Many real-world vibrations are random rather than perfectly harmonic. Random vibration is characterized by:</p>
        <ul>
            <li>Unpredictable instantaneous values</li>
            <li>Statistical parameters like mean and standard deviation</li>
            <li>Frequency content described by Power Spectral Density (PSD)</li>
        </ul>

        <h3>Power Spectral Density (PSD)</h3>
        <p>The PSD describes how the power of a signal is distributed across different frequencies:</p>

        <div class="equation-box">
            <p>For base excitation with input PSD $S_y(f)$, the response PSD is:</p>
            <p>$S_x(f) = |H(f)|^2 S_y(f)$</p>
            <p>Where $H(f)$ is the frequency response function (FRF):</p>
            <p>$H(f) = \frac{1}{-m\omega^2 + j\omega c + k}$</p>
        </div>

        <h3>RMS Response</h3>
        <p>The root-mean-square (RMS) response can be calculated from the PSD:</p>

        <div class="equation-box">
            <p>$x_{RMS} = \sqrt{\int_{0}^{\infty} S_x(f) df}$</p>
            <p>For a broadband random excitation with constant PSD $S_0$ and lightly damped system:</p>
            <p>$x_{RMS} \approx \sqrt{\frac{\pi f_n S_0}{4\zeta}}$</p>
            <p>Where $f_n$ is the natural frequency in Hz.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Engineering Applications</h2>

        <h3>Vibration Isolation</h3>
        <p>Vibration isolation aims to reduce the transmission of vibration from one structure to another. For base excitation:</p>
        <ul>
            <li>To isolate a sensitive equipment from floor vibration, we want to minimize the displacement transmissibility</li>
            <li>This is achieved by designing the mounting system to have a natural frequency much lower than the excitation frequency</li>
            <li>A general rule of thumb is to ensure $\rho > 3$ for good isolation</li>
        </ul>

        <h3>Seismic Response</h3>
        <p>Buildings during earthquakes experience base excitation from ground motion:</p>
        <ul>
            <li>Low-rise, stiff buildings have high natural frequencies and generally move with the ground</li>
            <li>Tall, flexible buildings have low natural frequencies and can experience amplified motion if their natural frequency matches the predominant earthquake frequency</li>
        </ul>
    </div>

<!-- SUMMARY SECTION -->
<div class="content-section">
    <h2>Summary of Key Equations</h2>
    <div class="equation-table">
        <table>
            <thead>
                <tr>
                    <th>Concept</th>
                    <th>Equation</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
            <tr>
                <td>Equation of Motion</td>
                <td>$m\ddot{z} + c\dot{z} + kz = -m\ddot{y}$</td>
                <td>Base excitation equation</td>
            </tr>
            <tr>
                <td>Natural Frequency</td>
                <td>$\omega_n = \sqrt{\frac{k}{m}}$</td>
                <td>Undamped natural frequency</td>
            </tr>
            <tr>
                <td>Damping Ratio</td>
                <td>$\zeta = \frac{c}{2\sqrt{km}}$</td>
                <td>Damping ratio</td>
            </tr>
            <tr>
                <td>Frequency Ratio</td>
                <td>\(\rho = \frac{\omega}{\omega_n}\)</td>
                <td>Excitation to natural frequency ratio</td>
            </tr>
            <tr>
                <td>Transmissibility</td>
                <td>\(T_d = \frac{F_t}{k Y} = \frac{\sqrt{1+(2\zeta \rho)^2}}{\sqrt{(1-\rho^2)^2+(2\zeta \rho)^2}}\)</td>
                <td>Force transmitted to base</td>
            </tr>
            <tr>
                <td>Absolute Response</td>
                <td>\(X = Y \cdot T_d\)</td>
                <td>Mass displacement amplitude</td>
            </tr>
            <tr>
                <td>Relative Response</td>
                <td>\(Z = Y\cdot\frac{\rho^2}{\sqrt{(1-\rho^2)^2+(2\zeta \rho)^2}}\)</td>
                <td>Displacement relative to base</td>
            </tr>
            <tr>
                <td>Isolation Criterion</td>
                <td>\(T_d < 1\) when \(\rho > \sqrt{2}\)</td>
                <td>Condition for vibration isolation</td>
            </tr>
            <tr>
                <td>Response PSD</td>
                <td>$S_x(f) = |H(f)|^2 S_y(f)$</td>
                <td>Response power spectral density</td>
            </tr>
            <tr>
                <td>RMS from PSD</td>
                <td>$x_{RMS} = \sqrt{\int_{0}^{\infty} S_x(f) df}$</td>
                <td>Root-mean-square response</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

    <script>
        // System parameters
        let mass = 2.0;
        let stiffness = 500;
        let damping = 10;
        let amplitude = 0.02;
        let frequency = 3.0;
        
        // Derived parameters
        let naturalFrequency = Math.sqrt(stiffness / mass);
        let dampingRatio = damping / (2 * Math.sqrt(mass * stiffness));
        
        // Simulation state
        let running = false;
        let time = 0;
        const dt = 0.01;
        
        // DOM elements
        const massSlider = document.getElementById('mass-slider');
        const massValue = document.getElementById('mass-value');
        const stiffnessSlider = document.getElementById('stiffness-slider');
        const stiffnessValue = document.getElementById('stiffness-value');
        const dampingSlider = document.getElementById('damping-slider');
        const dampingValue = document.getElementById('damping-value');
        const amplitudeSlider = document.getElementById('amplitude-slider');
        const amplitudeValue = document.getElementById('amplitude-value');
        const frequencySlider = document.getElementById('frequency-slider');
        const frequencyValue = document.getElementById('frequency-value');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        
        // P5.js sketch
        new p5(function(p) {
            const canvasWidth = 600;
            const canvasHeight = 500;
            
            // Animation constants
            const baseWidth = 150;
            const baseHeight = 40;
            const massWidth = 100;
            const massHeight = 60;
            const groundY = canvasHeight - 40;
            const restPositionY = groundY - 120 - baseHeight;
            const scale = 1000; // Scale displacements for visualization
            
            // Data arrays for visualization
            const historySize = 300;
            const historyData = {
                time: Array(historySize).fill(0),
                base: Array(historySize).fill(0),
                mass: Array(historySize).fill(0),
                relative: Array(historySize).fill(0)
            };
            let historyIndex = 0;
            
            // Current state
            let baseDisplacement = 0;
            let massDisplacement = 0;
            let relativeDisplacement = 0;
            
            p.setup = function() {
                let canvas = p.createCanvas(canvasWidth, canvasHeight);
                canvas.parent('sdof-sketch');
                p.frameRate(60);
                
                // Register event listeners
                massSlider.addEventListener('input', updateParameter);
                stiffnessSlider.addEventListener('input', updateParameter);
                dampingSlider.addEventListener('input', updateParameter);
                amplitudeSlider.addEventListener('input', updateParameter);
                frequencySlider.addEventListener('input', updateParameter);
                
                startButton.addEventListener('click', toggleSimulation);
                resetButton.addEventListener('click', resetSimulation);
            };
            
            p.draw = function() {
                // Update simulation if running
                if (running) {
                    updateSimulation();
                }
                
                // Clear background
                p.background(240);
                
                // Draw ground
                /* p.fill(120);
                p.noStroke();
                p.rect(0, groundY, canvasWidth, canvasHeight - groundY); */
                
                // Calculate positions
                const baseY = groundY - baseHeight + baseDisplacement * scale;
                const massY = restPositionY + massDisplacement * scale;
                
                // Draw base
                p.fill(150);
                p.rect(canvasWidth/2 - baseWidth/2, baseY, baseWidth, baseHeight);
                
                // Draw spring
                drawSpring(p, canvasWidth/2 - 30, baseY, canvasWidth/2 - 30, massY + massHeight);
                
                // Draw damper
                drawDamper(p, canvasWidth/2 + 30, baseY, canvasWidth/2 + 30, massY + massHeight);
                
                // Draw mass
                p.fill(200, 100, 100);
                p.rect(canvasWidth/2 - massWidth/2, massY, massWidth, massHeight);
                
                // Draw time plot
                drawTimePlot(p);
                
                // Draw transmissibility curve
                drawTransmissibilityCurve(p);
                
                // Draw system info
                drawSystemInfo(p);
            };
            
            function drawSpring(p, x1, y1, x2, y2) {
                const segments = 12;
                const coilWidth = 12;
                
                p.stroke(0);
                p.strokeWeight(2);
                p.noFill();
                
                p.beginShape();
                p.vertex(x1, y1);
                
                const dy = (y2 - y1) / segments;
                for (let i = 1; i < segments; i++) {
                    const y = y1 + i * dy;
                    const x = x1 + ((i % 2 === 0) ? -coilWidth : coilWidth);
                    p.vertex(x, y);
                }
                
                p.vertex(x2, y2);
                p.endShape();
            }
            
            function drawDamper(p, x1, y1, x2, y2) {
                p.stroke(0);
                p.strokeWeight(2);
                
                // Cylinder body
                const cylinderHeight = 40;
                const cylinderY = (y1 + y2) / 2 - cylinderHeight/2;
                
                p.fill(180);
                //p.rect(x1 - 15, cylinderY, 30, cylinderHeight);
                
                // Connecting rods
                p.line(x1, y1, x1, cylinderY);
                p.line(x2, y2, x2, cylinderY + cylinderHeight/2);
                
                // Piston head
                p.rect(x2 - 18, cylinderY + cylinderHeight/2 - 10, 36, 20);
            }
            
            function drawTimePlot(p) {
                const plotX = 20;
                const plotY = 20;
                const plotWidth = 250;
                const plotHeight = 150;
                
                // Plot background
                p.fill(255);
                p.stroke(0);
                p.strokeWeight(1);
                p.rect(plotX, plotY, plotWidth, plotHeight);
                
                // Plot title
                p.fill(0);
                p.noStroke();
                p.textAlign(p.CENTER);
                p.textSize(12);
                p.text("Time Response", plotX + plotWidth/2, plotY - 5);
                
                // Plot axes
                p.stroke(0);
                p.line(plotX, plotY + plotHeight/2, plotX + plotWidth, plotY + plotHeight/2); // x-axis
                
                // Plot data
                p.noFill();
                
                // Base motion (blue)
                p.stroke(0, 0, 255);
                p.beginShape();
                for (let i = 0; i < historySize; i++) {
                    const idx = (historyIndex + i) % historySize;
                    const x = plotX + (i / historySize) * plotWidth;
                    const y = plotY + plotHeight/2 - historyData.base[idx] * scale * 0.5;
                    p.vertex(x, y);
                }
                p.endShape();
                
                // Mass motion (red)
                p.stroke(255, 0, 0);
                p.beginShape();
                for (let i = 0; i < historySize; i++) {
                    const idx = (historyIndex + i) % historySize;
                    const x = plotX + (i / historySize) * plotWidth;
                    const y = plotY + plotHeight/2 - historyData.mass[idx] * scale * 0.5;
                    p.vertex(x, y);
                }
                p.endShape();
                
                // Legend
                p.noStroke();
                p.fill(0, 0, 255);
                p.rect(plotX + 5, plotY + 5, 10, 10);
                p.fill(0);
                p.textAlign(p.LEFT);
                p.text("Base", plotX + 20, plotY + 15);
                
                p.fill(255, 0, 0);
                p.rect(plotX + 60, plotY + 5, 10, 10);
                p.fill(0);
                p.text("Mass", plotX + 75, plotY + 15);
            }
            
            function drawTransmissibilityCurve(p) {
                const plotX = 330;
                const plotY = 20;
                const plotWidth = 250;
                const plotHeight = 150;
                
                // Plot background
                p.fill(255);
                p.stroke(0);
                p.strokeWeight(1);
                p.rect(plotX, plotY, plotWidth, plotHeight);
                
                // Plot title
                p.fill(0);
                p.noStroke();
                p.textAlign(p.CENTER);
                p.textSize(12);
                p.text("Transmissibility", plotX + plotWidth/2, plotY - 5);
                
                // Plot axes
                p.stroke(0);
                p.line(plotX, plotY + plotHeight, plotX + plotWidth, plotY + plotHeight); // x-axis
                p.line(plotX, plotY, plotX, plotY + plotHeight); // y-axis
                
                // Plot transmissibility curve
                p.stroke(0);
                p.noFill();
                p.beginShape();
                
                const maxR = 3;
                for (let i = 0; i <= 100; i++) {
                    const r = maxR * i / 100;
                    if (r < 0.05) continue; // Skip very low r values to avoid division by near-zero
                    
                    const tr = calcTransmissibility(r);
                    const x = plotX + (r / maxR) * plotWidth;
                    const y = plotY + plotHeight - Math.min(tr, 5) * (plotHeight / 5);
                    
                    p.vertex(x, y);
                }
                p.endShape();
                
                // Plot current operating point
                const currentR = 2 * Math.PI * frequency / naturalFrequency;
                const currentTr = calcTransmissibility(currentR);
                
                const pointX = plotX + (currentR / maxR) * plotWidth;
                const pointY = plotY + plotHeight - Math.min(currentTr, 5) * (plotHeight / 5);
                
                p.fill(255, 0, 0);
                p.noStroke();
                p.ellipse(pointX, pointY, 8, 8);
                
                // Labels
                p.fill(0);
                p.textAlign(p.CENTER);
                p.textSize(10);
                p.text("Frequency Ratio (rho)", plotX + plotWidth/2, plotY + plotHeight + 30);
                
                p.push();
                p.translate(plotX - 15, plotY + plotHeight/2);
                p.rotate(-p.HALF_PI);
                p.text("Transmissibility", 0, -5);
                p.pop();
                
                // Axis ticks
                p.textAlign(p.CENTER);
                p.textSize(8);
                for (let r = 0; r <= maxR; r += 0.5) {
                    const x = plotX + (r / maxR) * plotWidth;
                    p.line(x, plotY + plotHeight, x, plotY + plotHeight + 5);
                    p.text(r.toFixed(1), x, plotY + plotHeight + 15);
                }
                
                p.textAlign(p.RIGHT);
                for (let tr = 0; tr <= 5; tr += 1) {
                    const y = plotY + plotHeight - tr * (plotHeight / 5);
                    p.line(plotX - 5, y, plotX, y);
                    p.text(tr.toFixed(0), plotX - 8, y + 3);
                }
            }
            
            function drawSystemInfo(p) {
                const infoX = 20;
                const infoY = 190;
                
                p.fill(0);
                p.noStroke();
                p.textAlign(p.LEFT);
                p.textSize(14);
                
                // Calculate derived parameters
                const wn = naturalFrequency;
                const fn = wn / (2 * Math.PI);
                const zeta = dampingRatio;
                const currentR = 2 * Math.PI * frequency / wn;
                const tr = calcTransmissibility(currentR);
                
                p.text(`Natural Frequency: ${fn.toFixed(2)} Hz`, infoX, infoY);
                p.text(`Damping Ratio: ${zeta.toFixed(3)}`, infoX, infoY + 20);
                p.text(`Frequency Ratio: ${currentR.toFixed(2)}`, infoX, infoY + 40);
                p.text(`Transmissibility: ${tr.toFixed(2)}`, infoX, infoY + 60);
            }
            
            function updateSimulation() {
                // Increment time
                time += dt;

                // Calculate base motion (harmonic)
                const omega = 2 * Math.PI * frequency;
                const omegaN = naturalFrequency;
                const r = omega / omegaN; // Frequency ratio
                const zeta = dampingRatio;

                baseDisplacement = amplitude * Math.sin(omega * time);

                // Use analytical steady-state solution for accurate phase representation
                // For base excitation: X/Y = TR * exp(i*phi)
                // where TR is transmissibility and phi is phase angle

                // Transmissibility (amplitude ratio)
                const TR = Math.sqrt((1 + Math.pow(2*zeta*r, 2)) /
                                    (Math.pow(1 - r*r, 2) + Math.pow(2*zeta*r, 2)));

                // Phase angle of absolute mass motion relative to base
                // tan(phi) = (2*zeta*r^3) / (1 - r^2 + (2*zeta*r)^2)
                const phaseNumerator = 2 * zeta * Math.pow(r, 3);
                const phaseDenominator = 1 - r*r + Math.pow(2*zeta*r, 2);
                const phase = Math.atan2(phaseNumerator, phaseDenominator);

                // Absolute mass displacement with correct phase
                massDisplacement = amplitude * TR * Math.sin(omega * time - phase);

                // Relative displacement
                relativeDisplacement = massDisplacement - baseDisplacement;
                
                // Store in history buffer (circular buffer)
                historyData.time[historyIndex] = time;
                historyData.base[historyIndex] = baseDisplacement;
                historyData.mass[historyIndex] = massDisplacement;
                historyData.relative[historyIndex] = relativeDisplacement;
                
                // Increment history index
                historyIndex = (historyIndex + 1) % historySize;
            }
            
            function updateParameter() {
                // Update parameters from sliders
                mass = parseFloat(massSlider.value);
                massValue.textContent = mass.toFixed(1) + " kg";
                
                stiffness = parseFloat(stiffnessSlider.value);
                stiffnessValue.textContent = stiffness.toFixed(0) + " N/m";
                
                damping = parseFloat(dampingSlider.value);
                dampingValue.textContent = damping.toFixed(1) + " Ns/m";
                
                amplitude = parseFloat(amplitudeSlider.value);
                amplitudeValue.textContent = amplitude.toFixed(3) + " m";
                
                frequency = parseFloat(frequencySlider.value);
                frequencyValue.textContent = frequency.toFixed(1) + " Hz";
                
                // Update derived parameters
                naturalFrequency = Math.sqrt(stiffness / mass);
                dampingRatio = damping / (2 * Math.sqrt(mass * stiffness));
            }
            
            function toggleSimulation() {
                running = !running;
                startButton.textContent = running ? "Pause" : "Start";
            }
            
            function resetSimulation() {
                running = false;
                startButton.textContent = "Start";
                time = 0;
                baseDisplacement = 0;
                massDisplacement = 0;
                relativeDisplacement = 0;

                // Clear history
                for (let i = 0; i < historySize; i++) {
                    historyData.time[i] = 0;
                    historyData.base[i] = 0;
                    historyData.mass[i] = 0;
                    historyData.relative[i] = 0;
                }
                historyIndex = 0;
            }
            
            function calcTransmissibility(r) {
                const zeta = dampingRatio;
                return Math.sqrt(
                    (1 + Math.pow(2 * zeta * r, 2)) / 
                    (Math.pow(1 - r * r, 2) + Math.pow(2 * zeta * r, 2))
                );
            }
        });
        
        // toggleSolution function now loaded from /assets/common/problems.js
    </script>

<!-- PRACTICE PROBLEMS SECTION -->
<div class="content-section">
    <h2>Practice Problems</h2>

    <div class="practice-problems">
        <h3>Problem 1: Vibration Isolation Design</h3>
        <p>A sensitive electronic device with mass 5 kg needs to be isolated from a base that vibrates with a frequency of 50 Hz. What should be the stiffness of the isolator to ensure the transmissibility is less than 0.1?</p>

        <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
        <div id="solution1" class="hidden">
            <p>For transmissibility to be less than 0.1:</p>
            <p>$T_d = \frac{1}{\rho^2} < 0.1$ (assuming high frequency, where $\rho \gg 1$)</p>
            <p>$\rho^2 > 10$</p>
            <p>$\rho > 3.16$</p>
            <p>Since $\rho = \frac{\omega}{\omega_n} = \frac{2\pi \times 50}{\sqrt{k/m}}$, we need:</p>
            <p>$2\pi \times 50 > 3.16 \times \sqrt{k/5}$</p>
            <p>$k < \frac{(2\pi \times 50)^2 \times 5}{3.16^2} = 12,411 \text{ N/m}$</p>
            <p>To ensure transmissibility less than 0.1, the stiffness should be less than 12,411 N/m.</p>
        </div>
    </div>

    <div class="practice-problems">
        <h3>Problem 2: Base Excitation Response</h3>
        <p>A machine with mass 100 kg is mounted on a platform using springs with total stiffness 40,000 N/m and dampers with damping coefficient 1,000 Ns/m. If the platform undergoes harmonic motion with amplitude 5 mm and frequency 10 Hz, calculate:</p>
        <ol>
            <li>The natural frequency of the system</li>
            <li>The steady-state amplitude of the machine's motion relative to the platform</li>
            <li>The transmissibility ratio</li>
        </ol>

        <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
        <div id="solution2" class="hidden">
            <p>a) Natural frequency:</p>
            <p>$\omega_n = \sqrt{\frac{k}{m}} = \sqrt{\frac{40,000}{100}} = 20 \text{ rad/s}$</p>
            <p>$f_n = \frac{\omega_n}{2\pi} = \frac{20}{2\pi} = 3.18 \text{ Hz}$</p>

            <p>b) Frequency ratio and damping ratio:</p>
            <p>$\rho = \frac{\omega}{\omega_n} = \frac{2\pi \times 10}{20} = 3.14$</p>
            <p>$\zeta = \frac{c}{2\sqrt{km}} = \frac{1,000}{2\sqrt{40,000 \times 100}} = 0.25$</p>

            <p>c) Relative displacement amplitude:</p>
            <p>$Z = Y\cdot\frac{\rho^2}{\sqrt{(1-\rho^2)^2+(2\zeta \rho)^2}} = 0.005 \cdot \frac{3.14^2}{\sqrt{(1-3.14^2)^2+(2 \times 0.25 \times 3.14)^2}}$</p>
            <p>$Z = 0.005 \cdot \frac{9.86}{\sqrt{83.27}} = 0.005 \cdot \frac{9.86}{9.13} = 0.0054 \text{ m} = 5.4 \text{ mm}$</p>

            <p>d) Transmissibility:</p>
            <p>$T_d = \sqrt{\frac{1+(2\zeta \rho)^2}{(1-\rho^2)^2+(2\zeta \rho)^2}} = \sqrt{\frac{1+(2 \times 0.25 \times 3.14)^2}{(1-3.14^2)^2+(2 \times 0.25 \times 3.14)^2}}$</p>
            <p>$T_d = \sqrt{\frac{1+2.46}{83.27}} = \sqrt{\frac{3.46}{83.27}} = 0.204$</p>
            <p>The transmissibility ratio is 0.204, meaning the motion is attenuated to approximately 20.4% of the base motion.</p>
        </div>
    </div>

    <div class="practice-problems">
        <h3>Problem 3: Seismic Isolation System</h3>
        <p>A building with mass 200,000 kg is equipped with a seismic isolation system. During an earthquake, the ground experiences harmonic motion with amplitude 100 mm and frequency 2 Hz. The isolation system has:</p>
        <ul>
            <li>Total stiffness: k = 8 MN/m</li>
            <li>Damping coefficient: c = 400 kNs/m</li>
        </ul>
        <p>Calculate:</p>
        <ol type="a">
            <li>The natural frequency \(\omega_n\) and frequency ratio \(\rho\)</li>
            <li>The damping ratio \(\zeta\)</li>
            <li>The transmissibility \(T_d\)</li>
            <li>The absolute displacement amplitude of the building</li>
            <li>Whether this isolation system is effective</li>
        </ol>

        <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
        <div id="solution3" class="hidden">
            <p><strong>(a) Natural frequency and frequency ratio:</strong></p>
            <p>\[\omega_n = \sqrt{\frac{k}{m}} = \sqrt{\frac{8 \times 10^6}{200,000}} = \sqrt{40} = 6.32 \text{ rad/s}\]</p>
            <p>\[f_n = \frac{\omega_n}{2\pi} = \frac{6.32}{2\pi} = 1.01 \text{ Hz}\]</p>
            <p>Excitation frequency: \(\omega = 2\pi f = 2\pi \times 2 = 12.57 \text{ rad/s}\)</p>
            <p>\[\rho = \frac{\omega}{\omega_n} = \frac{12.57}{6.32} = 1.99\]</p>

            <p><strong>(b) Damping ratio:</strong></p>
            <p>\[\zeta = \frac{c}{2\sqrt{km}} = \frac{400,000}{2\sqrt{8 \times 10^6 \times 200,000}} = \frac{400,000}{2 \times 1,264,911} = 0.158\]</p>

            <p><strong>(c) Transmissibility:</strong></p>
            <p>\[T_d = \sqrt{\frac{1 + (2\zeta \rho)^2}{(1 - \rho^2)^2 + (2\zeta \rho)^2}}\]</p>
            <p>\[T_d = \sqrt{\frac{1 + (2 \times 0.158 \times 1.99)^2}{(1 - 1.99^2)^2 + (2 \times 0.158 \times 1.99)^2}}\]</p>
            <p>\[T_d = \sqrt{\frac{1 + 0.396}{(1 - 3.96)^2 + 0.396}} = \sqrt{\frac{1.396}{8.76 + 0.396}} = \sqrt{\frac{1.396}{9.16}} = 0.390\]</p>

            <p><strong>(d) Absolute displacement amplitude of building:</strong></p>
            <p>\[X = Y \times T_d = 100 \text{ mm} \times 0.390 = 39.0 \text{ mm}\]</p>

            <p><strong>(e) Effectiveness assessment:</strong></p>
            <p>The isolation system reduces ground motion to 39% of its original amplitude (61% reduction). Since \(\rho = 1.99 \approx 2\), the system operates near the resonance region boundary. For \(T_d < 1\) (isolation), we need \(\rho > \sqrt{2} = 1.414\), which is satisfied. The system is <strong>effective</strong>, reducing building motion by 61% compared to the ground motion. However, for better isolation (e.g., \(T_d < 0.2\)), a softer spring system or higher frequency ratio would be needed.</p>
        </div>
    </div>
</div>

<!-- QUIZ SECTION -->
<div class="content-section">
    <h2>Knowledge Check Quiz</h2>
    <div class="quiz-container">
        <div class="quiz-question">
            <h3>Question 1: What is base excitation in vibration analysis?</h3>
            <div class="quiz-options">
                <label><input type="radio" name="q1" value="a"> Exciting a system by applying a direct force to the mass</label>
                <label><input type="radio" name="q1" value="b"> Exciting a system through motion of its support or foundation</label>
                <label><input type="radio" name="q1" value="c"> The initial displacement given to a mass</label>
                <label><input type="radio" name="q1" value="d"> The natural oscillation of an undamped system</label>
            </div>
        </div>

        <div class="quiz-question">
            <h3>Question 2: For effective vibration isolation, the frequency ratio \(\rho = \omega/\omega_n\) should be:</h3>
            <div class="quiz-options">
                <label><input type="radio" name="q2" value="a"> Less than 1</label>
                <label><input type="radio" name="q2" value="b"> Equal to 1</label>
                <label><input type="radio" name="q2" value="c"> Greater than \(\sqrt{2}\)</label>
                <label><input type="radio" name="q2" value="d"> Between 0.5 and 1.5</label>
            </div>
        </div>

        <div class="quiz-question">
            <h3>Question 3: What is transmissibility \(T_d\)?</h3>
            <div class="quiz-options">
                <label><input type="radio" name="q3" value="a"> The ratio of excitation frequency to natural frequency</label>
                <label><input type="radio" name="q3" value="b"> The ratio of damping coefficient to critical damping</label>
                <label><input type="radio" name="q3" value="c"> The ratio of transmitted force (or displacement) to excitation force (or displacement)</label>
                <label><input type="radio" name="q3" value="d"> The ratio of stiffness to mass</label>
            </div>
        </div>

        <div class="quiz-question">
            <h3>Question 4: At resonance (\(\rho = 1\)), which factor most significantly affects the amplitude response?</h3>
            <div class="quiz-options">
                <label><input type="radio" name="q4" value="a"> Mass of the system</label>
                <label><input type="radio" name="q4" value="b"> Stiffness of the spring</label>
                <label><input type="radio" name="q4" value="c"> Damping ratio \(\zeta\)</label>
                <label><input type="radio" name="q4" value="d"> Excitation amplitude</label>
            </div>
        </div>

        <div class="quiz-question">
            <h3>Question 5: Why are tall buildings more vulnerable to earthquakes than low-rise buildings?</h3>
            <div class="quiz-options">
                <label><input type="radio" name="q5" value="a"> They have higher mass</label>
                <label><input type="radio" name="q5" value="b"> They have lower natural frequencies that can match earthquake frequency ranges</label>
                <label><input type="radio" name="q5" value="c"> They have less damping</label>
                <label><input type="radio" name="q5" value="d"> They experience higher ground accelerations</label>
            </div>
        </div>

        <button id="submit-quiz">Submit Quiz</button>
        <div id="quiz-results"></div>
    </div>
</div>

<script>
// Quiz handler for Base Excitation
document.getElementById('submit-quiz').addEventListener('click', function() {
    const answers = {
        q1: 'b',  // Motion of support
        q2: 'c',  // \rho > sqrt(2) for isolation
        q3: 'c',  // Ratio of transmitted to excitation
        q4: 'c',  // Damping ratio controls resonance amplitude
        q5: 'b'   // Low natural frequency matches earthquake frequency
    };

    let score = 0;
    let totalQuestions = Object.keys(answers).length;
    let resultsHTML = '<h3>Quiz Results:</h3>';

    for (let question in answers) {
        const selectedOption = document.querySelector(`input[name="${question}"]:checked`);
        const correctAnswer = answers[question];

        if (selectedOption) {
            if (selectedOption.value === correctAnswer) {
                score++;
                resultsHTML += `<p style="color: #28a745; font-weight: bold;">${question.toUpperCase()}: Correct! ✓</p>`;
            } else {
                resultsHTML += `<p style="color: #dc3545; font-weight: bold;">${question.toUpperCase()}: Incorrect ✗</p>`;
            }
        } else {
            resultsHTML += `<p style="color: #333;">${question.toUpperCase()}: Not answered</p>`;
        }
    }

    const percentage = ((score / totalQuestions) * 100).toFixed(0);
    resultsHTML = `<p style="font-size: 1.2em; font-weight: bold;">You scored ${score} out of ${totalQuestions} (${percentage}%)</p>` + resultsHTML;

    document.getElementById('quiz-results').innerHTML = resultsHTML;
});
</script>

    <!-- Common JavaScript functions -->
    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

<footer>
    <script src="/assets/common/footer.js"></script>
</footer>

</body>
</html>