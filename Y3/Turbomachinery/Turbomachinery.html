<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbomachinery and Velocity Triangles - Interactive Lecture</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/problems.css">
    <link rel="stylesheet" href="/assets/css/quizzes.css">
    <link rel="stylesheet" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">
</head>
<body>
    <header>
        <h1>Turbomachinery and Velocity Triangles</h1>
        <p class="subtitle">Understanding Energy Transfer in Turbines and Compressors</p>
    </header>

    <div class="content-section">
        <h2>Understanding Turbomachinery</h2>

        <h3>What is Turbomachinery?</h3>
        <p>Turbomachinery refers to devices that transfer energy between a rotating shaft and a fluid. This includes turbines (extract energy from fluid), compressors and pumps (add energy to fluid), and fans. The key to understanding these machines is analyzing the velocity triangles at blade inlet and outlet.</p>

        <div class="key-point">
            <p><strong>Core Insight:</strong> Energy transfer in turbomachinery is governed by the change in angular momentum of the fluid as it passes through the blade row. Velocity triangles allow us to visualize and quantify this momentum exchange, directly linking blade geometry to performance.</p>
        </div>

        <h3>Velocity Triangle Fundamentals</h3>
        <p>At any point in a turbomachine, three velocity vectors form a triangle:</p>

        <div class="equation-box">
            <p><strong>Velocity Components:</strong></p>
            <ul style="list-style: none;">
                <li>\(\vec{V}\) = Absolute velocity (relative to stationary frame)</li>
                <li>\(\vec{U}\) = Blade velocity = \(\omega r\) (tangential speed)</li>
                <li>\(\vec{W}\) = Relative velocity (relative to moving blade)</li>
            </ul>
            <p><strong>Vector Relationship:</strong></p>
            <p>\[\vec{V} = \vec{U} + \vec{W}\]</p>
            <p>Each velocity is decomposed into:</p>
            <ul style="list-style: none;">
                <li>Tangential (θ) component: \(V_\theta, U, W_\theta\)</li>
                <li>Axial (z) component: \(V_z, W_z\) (note: U has no axial component)</li>
            </ul>
        </div>

        <h3>Euler Turbine Equation</h3>
        <p>The fundamental equation for energy transfer in turbomachinery:</p>

        <div class="equation-box">
            <p>\[W = U_2 V_{\theta 2} - U_1 V_{\theta 1}\]</p>
            <p>where:</p>
            <ul style="list-style: none;">
                <li>\(W\) = specific work (J/kg) = work per unit mass</li>
                <li>\(U\) = blade velocity (m/s)</li>
                <li>\(V_\theta\) = tangential component of absolute velocity (m/s)</li>
                <li>Subscripts 1 and 2 denote inlet and outlet</li>
            </ul>
            <p><strong>Power:</strong></p>
            <p>\[\dot{W} = \dot{m} \cdot W = \dot{m}(U_2 V_{\theta 2} - U_1 V_{\theta 1})\]</p>
            <p>where \(\dot{m}\) is the mass flow rate (kg/s)</p>
        </div>

        <h3>Blade Angles</h3>
        <p>The blade geometry is defined by angles measured from the axial direction:</p>

        <div class="equation-box">
            <p><strong>Absolute flow angle:</strong> \(\alpha\) (angle of \(\vec{V}\) from axial)</p>
            <p>\[\tan \alpha = \frac{V_\theta}{V_z}\]</p>
            <p><strong>Relative flow angle:</strong> \(\beta\) (angle of \(\vec{W}\) from axial)</p>
            <p>\[\tan \beta = \frac{W_\theta}{W_z}\]</p>
            <p><strong>For axial machines:</strong> \(V_z \approx W_z = V_a\) (constant axial velocity)</p>
        </div>

        <h3>Degree of Reaction</h3>
        <p>The degree of reaction indicates how much pressure change occurs in the rotor vs the stator:</p>

        <div class="equation-box">
            <p>\[R = \frac{\text{Pressure rise in rotor}}{\text{Total pressure rise}} = \frac{W_1^2 - W_2^2}{V_1^2 - V_2^2 + W_1^2 - W_2^2}\]</p>
            <p>For an axial compressor with \(V_a\) constant:</p>
            <p>\[R = \frac{W_{\theta 1}^2 - W_{\theta 2}^2}{2U(V_{\theta 2} - V_{\theta 1})}\]</p>
            <p><strong>Special Cases:</strong></p>
            <ul>
                <li>\(R = 0\): All pressure rise in stator (impulse stage)</li>
                <li>\(R = 0.5\): Equal pressure rise in rotor and stator (reaction stage)</li>
                <li>\(R = 1\): All pressure rise in rotor</li>
            </ul>
        </div>

        <h3>Turbine vs Compressor</h3>
        <div class="key-point">
            <p><strong>Energy Direction:</strong></p>
            <ul>
                <li><strong>Turbine:</strong> Fluid does work on blades, \(V_{\theta 2} < V_{\theta 1}\), power extracted</li>
                <li><strong>Compressor:</strong> Blades do work on fluid, \(V_{\theta 2} > V_{\theta 1}\), power input</li>
                <li><strong>Pump:</strong> Similar to compressor but for liquids (incompressible)</li>
            </ul>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Velocity Triangle Builder</h2>
        <p>Adjust the parameters to build velocity triangles for a turbine or compressor stage. See how blade angles and speeds affect energy transfer. Watch how the blade profiles change based on the relative flow angles β!</p>

        <div class="controls-grid-2col">
            <div class="control-group">
                <label for="machine-type">Machine Type:</label>
                <select id="machine-type">
                    <option value="turbine">Turbine</option>
                    <option value="compressor">Compressor</option>
                </select>
            </div>

            <div class="control-group">
                <label for="blade-speed">Blade Speed U (m/s): <span id="blade-speed-value">200</span></label>
                <input type="range" id="blade-speed" min="50" max="400" step="10" value="200">
            </div>

            <div class="control-group">
                <label for="axial-velocity">Axial Velocity Va (m/s): <span id="axial-velocity-value">150</span></label>
                <input type="range" id="axial-velocity" min="50" max="300" step="10" value="150">
            </div>

            <div class="control-group">
                <label for="inlet-angle">Inlet Absolute Angle α₁ (deg): <span id="inlet-angle-value">45</span></label>
                <input type="range" id="inlet-angle" min="0" max="75" step="5" value="45">
            </div>

            <div class="control-group">
                <label for="outlet-angle">Outlet Absolute Angle α₂ (deg): <span id="outlet-angle-value">15</span></label>
                <input type="range" id="outlet-angle" min="0" max="75" step="5" value="15">
            </div>
        </div>

        <div id="sketch-holder"></div>
    </div>

    <script>
        let sketch = new p5(function(p) {
            let machineType = 'turbine';
            let U = 200;        // Blade speed (m/s)
            let Va = 150;       // Axial velocity (m/s)
            let alpha1 = 45;    // Inlet absolute angle (degrees)
            let alpha2 = 15;    // Outlet absolute angle (degrees)

            // Calculated values
            let V1, V2, W1, W2;
            let Vtheta1, Vtheta2, Wtheta1, Wtheta2;
            let beta1, beta2;
            let work, power, reaction;

            // Animation variables
            let rotationAngle = 0;

            p.setup = function() {
                let canvas = p.createCanvas(900, 700);
                canvas.parent('sketch-holder');

                setupControls();
                calculateVelocities();
            };

            function setupControls() {
                document.getElementById('machine-type').addEventListener('change', function() {
                    machineType = this.value;
                    setMachineDefaults();
                });

                document.getElementById('blade-speed').addEventListener('input', function() {
                    U = parseFloat(this.value);
                    document.getElementById('blade-speed-value').textContent = U;
                    calculateVelocities();
                });

                document.getElementById('axial-velocity').addEventListener('input', function() {
                    Va = parseFloat(this.value);
                    document.getElementById('axial-velocity-value').textContent = Va;
                    calculateVelocities();
                });

                document.getElementById('inlet-angle').addEventListener('input', function() {
                    alpha1 = parseFloat(this.value);
                    document.getElementById('inlet-angle-value').textContent = alpha1;
                    calculateVelocities();
                });

                document.getElementById('outlet-angle').addEventListener('input', function() {
                    alpha2 = parseFloat(this.value);
                    document.getElementById('outlet-angle-value').textContent = alpha2;
                    calculateVelocities();
                });
            }

            function setMachineDefaults() {
                if (machineType === 'turbine') {
                    // Turbine: high inlet swirl, low outlet swirl
                    alpha1 = 60;
                    alpha2 = 20;
                } else {
                    // Compressor: low inlet swirl, high outlet swirl
                    alpha1 = 10;
                    alpha2 = 50;
                }

                document.getElementById('inlet-angle').value = alpha1;
                document.getElementById('outlet-angle').value = alpha2;
                document.getElementById('inlet-angle-value').textContent = alpha1;
                document.getElementById('outlet-angle-value').textContent = alpha2;

                calculateVelocities();
            }

            function calculateVelocities() {
                // Convert angles to radians
                let a1_rad = alpha1 * Math.PI / 180;
                let a2_rad = alpha2 * Math.PI / 180;

                // Inlet: calculate V1 components
                Vtheta1 = Va * Math.tan(a1_rad);
                V1 = Va / Math.cos(a1_rad);

                // Outlet: calculate V2 components
                Vtheta2 = Va * Math.tan(a2_rad);
                V2 = Va / Math.cos(a2_rad);

                // Relative velocities: W = V - U (in tangential direction)
                Wtheta1 = Vtheta1 - U;
                Wtheta2 = Vtheta2 - U;

                // Relative velocity magnitudes
                W1 = Math.sqrt(Va * Va + Wtheta1 * Wtheta1);
                W2 = Math.sqrt(Va * Va + Wtheta2 * Wtheta2);

                // Relative flow angles
                beta1 = Math.atan2(Wtheta1, Va) * 180 / Math.PI;
                beta2 = Math.atan2(Wtheta2, Va) * 180 / Math.PI;

                // Specific work (Euler equation)
                work = U * (Vtheta2 - Vtheta1) / 1000; // kJ/kg

                // Power (assuming 10 kg/s mass flow)
                power = work * 10; // kW

                // Degree of reaction
                let numerator = (W1*W1 - W2*W2);
                let denominator = 2 * U * (Vtheta2 - Vtheta1);
                if (Math.abs(denominator) > 0.1) {
                    reaction = numerator / denominator;
                } else {
                    reaction = 0;
                }
            }

            p.draw = function() {
                p.background(255);

                // Update rotation angle for animation
                rotationAngle += 0.02;

                // Title
                p.fill(0);
                p.noStroke();
                p.textSize(18);
                p.textAlign(p.CENTER);
                let title = machineType === 'turbine' ? 'Turbine Velocity Triangles' : 'Compressor Velocity Triangles';
                p.text(title, 450, 30);

                // Draw inlet triangle
                drawVelocityTriangle(150, 200, 'Inlet', V1, Va, Vtheta1, W1, Wtheta1, U, alpha1, beta1);

                // Draw outlet triangle
                drawVelocityTriangle(550, 200, 'Outlet', V2, Va, Vtheta2, W2, Wtheta2, U, alpha2, beta2);

                // Draw blade cascade with rotation
                drawBladeCascade();

                // Draw info overlay (moved to bottom right)
                drawInfoOverlay();
            };

            function drawVelocityTriangle(x, y, label, V, Va_val, Vtheta, W, Wtheta, U_val, alpha, beta) {
                p.push();
                p.translate(x, y);

                // Scale for visualization
                let scale = 0.6;

                // Label
                p.fill(0);
                p.noStroke();
                p.textSize(16);
                p.textAlign(p.CENTER);
                p.text(label, 0, -120);

                // Origin
                p.fill(0);
                p.circle(0, 0, 8);

                // Draw U vector (blade velocity) - horizontal
                p.stroke(0, 150, 0);
                p.strokeWeight(3);
                p.fill(0, 150, 0);
                let U_scaled = U_val * scale;
                p.line(0, 0, U_scaled, 0);
                drawArrow(0, 0, U_scaled, 0, p.color(0, 150, 0));
                p.noStroke();
                p.textSize(14);
                p.textAlign(p.CENTER);
                p.text('U', U_scaled/2, -10);
                p.text(U_val.toFixed(0) + ' m/s', U_scaled/2, 20);

                // Draw V vector (absolute velocity)
                p.stroke(255, 0, 0);
                p.strokeWeight(3);
                p.fill(255, 0, 0);
                let V_x = Vtheta * scale;
                let V_y = -Va_val * scale; // Negative because y-axis points down
                p.line(0, 0, V_x, V_y);
                drawArrow(0, 0, V_x, V_y, p.color(255, 0, 0));
                p.noStroke();
                p.textAlign(p.LEFT);
                p.text('V', V_x + 5, V_y);
                p.text(V.toFixed(0) + ' m/s', V_x + 5, V_y + 15);
                p.text('α=' + alpha.toFixed(1) + '°', V_x + 5, V_y + 30);

                // Draw W vector (relative velocity)
                p.stroke(0, 0, 255);
                p.strokeWeight(3);
                p.fill(0, 0, 255);
                let W_x = Wtheta * scale;
                let W_y = -Va_val * scale;
                p.line(U_scaled, 0, V_x, V_y);
                drawArrow(U_scaled, 0, V_x, V_y, p.color(0, 0, 255));
                p.noStroke();
                p.textAlign(p.LEFT);
                let W_text_x = U_scaled + (V_x - U_scaled)/2;
                let W_text_y = V_y/2;
                p.text('W', W_text_x + 5, W_text_y - 10);
                p.text(W.toFixed(0) + ' m/s', W_text_x + 5, W_text_y + 5);
                p.text('β=' + beta.toFixed(1) + '°', W_text_x + 5, W_text_y + 20);

                // Draw velocity components as dashed lines
                p.stroke(200);
                p.strokeWeight(1);
                p.drawingContext.setLineDash([5, 5]);
                p.line(V_x, 0, V_x, V_y); // Va component
                p.line(0, V_y, V_x, V_y); // Vtheta component
                p.drawingContext.setLineDash([]);

                // Label components
                p.fill(100);
                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('Va=' + Va_val.toFixed(0), V_x + 25, V_y/2);
                p.text('Vθ=' + Vtheta.toFixed(0), V_x/2, 15);

                p.pop();
            }

            function drawArrow(x1, y1, x2, y2, col) {
                p.push();
                p.stroke(col);
                p.fill(col);
                let angle = Math.atan2(y2 - y1, x2 - x1);
                let arrowSize = 8;
                p.translate(x2, y2);
                p.rotate(angle);
                p.triangle(0, 0, -arrowSize, -arrowSize/2, -arrowSize, arrowSize/2);
                p.pop();
            }

            function drawBladeCascade() {
                let cascadeX = 450;
                let cascadeY = 500;

                p.push();
                p.translate(cascadeX, cascadeY);

                // Title
                p.fill(0);
                p.noStroke();
                p.textSize(16);
                p.textAlign(p.CENTER);
                p.text('Blade Cascade - Unwrapped Cylinder View', 0, -110);

                // Draw outer casing (top and bottom walls)
                p.stroke(60);
                p.strokeWeight(4);
                p.line(-400, -70, 400, -70);  // Top wall
                p.line(-400, 70, 400, 70);    // Bottom wall

                // INLET label
                p.fill(255, 0, 0);
                p.noStroke();
                p.textSize(13);
                p.textAlign(p.CENTER);
                p.text('INLET', -350, 0);

                // OUTLET label
                p.fill(0, 150, 0);
                p.text('OUTLET', 350, 0);

                // ========== STATOR SECTION (STATIONARY) ==========
                let statorX = -220;

                p.push();
                p.translate(statorX, 0);

                // Stator region background
                p.fill(100, 150, 200, 50);
                p.noStroke();
                p.rect(-60, -70, 120, 140);

                // Stator label
                p.fill(0);
                p.textSize(12);
                p.textAlign(p.CENTER);
                p.text('STATOR', 0, -85);
                p.textSize(10);
                p.text('(stationary)', 0, 90);

                // Draw 4 stator vanes in cascade
                let numStatorVanes = 4;
                let statorPitch = 35; // vertical spacing between vanes

                for (let i = 0; i < numStatorVanes; i++) {
                    let yPos = (i - 1.5) * statorPitch;

                    p.push();
                    p.translate(0, yPos);

                    // Rotate to align with flow angle α1
                    let statorAngle = -alpha1 * Math.PI / 180;
                    p.rotate(statorAngle);

                    // Draw stator vane (airfoil shape)
                    p.stroke(50);
                    p.strokeWeight(2);
                    p.fill(130, 160, 190);

                    p.beginShape();
                    // Leading edge (rounded)
                    p.vertex(-8, 0);
                    p.bezierVertex(-8, -3, -5, -4, 0, -4);
                    // Upper surface
                    p.bezierVertex(20, -4, 40, -3, 55, -1);
                    // Trailing edge (sharp)
                    p.vertex(55, 0);
                    // Lower surface
                    p.bezierVertex(40, 1, 20, 2, 0, 2);
                    p.bezierVertex(-5, 2, -8, 1, -8, 0);
                    p.endShape(p.CLOSE);

                    p.pop();
                }

                p.pop(); // End stator

                // Draw inlet flow arrow (V1 - absolute velocity)
                p.push();
                p.translate(-320, -20);
                let v1Angle = -alpha1 * Math.PI / 180;
                p.rotate(v1Angle);
                p.stroke(255, 0, 0);
                p.strokeWeight(3);
                p.fill(255, 0, 0);
                p.line(0, 0, 50, 0);
                drawArrowHead(50, 0, 0, p.color(255, 0, 0));
                p.pop();

                p.fill(255, 0, 0);
                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('V₁', -320, -35);
                p.textSize(9);
                p.text('α₁=' + alpha1.toFixed(0) + '°', -320, -25);

                // ========== ROTOR SECTION (ROTATING) ==========
                let rotorX = 70;

                p.push();
                p.translate(rotorX, 0);

                // Rotor region background
                p.fill(200, 150, 100, 50);
                p.noStroke();
                p.rect(-90, -70, 180, 140);

                // Rotor label
                p.fill(0);
                p.textSize(12);
                p.textAlign(p.CENTER);
                p.text('ROTOR', 0, -85);
                p.textSize(10);
                p.text('(rotating ↓↑)', 0, 90);

                // Show rotation with animated motion indicator
                p.push();
                p.translate(-110, 0);

                // Vertical motion arrows showing blade rotation
                let arrowOffset = (rotationAngle * 30) % 30;

                for (let i = -1; i < 3; i++) {
                    let arrowY = i * 30 + arrowOffset - 45;
                    if (arrowY > -80 && arrowY < 80) {
                        p.stroke(0, 120, 0);
                        p.strokeWeight(2);
                        p.fill(0, 120, 0);
                        p.line(-5, arrowY, -5, arrowY - 20);
                        p.triangle(-5, arrowY, -8, arrowY - 6, -2, arrowY - 6);
                    }
                }

                p.fill(0, 120, 0);
                p.noStroke();
                p.textSize(10);
                p.textAlign(p.CENTER);
                p.text('U', -5, 15);
                p.pop();

                // Draw 4 rotor blades in cascade
                let numRotorBlades = 4;
                let rotorPitch = 35; // vertical spacing

                for (let i = 0; i < numRotorBlades; i++) {
                    // Animate vertical position to show rotation
                    let baseY = (i - 1.5) * rotorPitch;
                    let animatedY = baseY + (rotationAngle * 5.5) % rotorPitch;

                    // Wrap around
                    if (animatedY > 80) animatedY -= numRotorBlades * rotorPitch;
                    if (animatedY < -80) animatedY += numRotorBlades * rotorPitch;

                    if (animatedY > -75 && animatedY < 75) {
                        p.push();
                        p.translate(0, animatedY);

                        // Rotate to align with average relative flow angle
                        let rotorBeta = (beta1 + beta2) / 2;
                        let rotorAngle = -rotorBeta * Math.PI / 180;
                        p.rotate(rotorAngle);

                        // Draw rotor blade (airfoil shape)
                        p.stroke(40);
                        p.strokeWeight(2);
                        p.fill(210, 170, 120);

                        p.beginShape();
                        // Leading edge
                        p.vertex(-10, 0);
                        p.bezierVertex(-10, -4, -6, -5, 0, -5);
                        // Upper surface
                        p.bezierVertex(25, -5, 50, -4, 70, -1.5);
                        // Trailing edge
                        p.vertex(70, 0);
                        // Lower surface
                        p.bezierVertex(50, 1.5, 25, 2.5, 0, 2.5);
                        p.bezierVertex(-6, 2.5, -10, 1.5, -10, 0);
                        p.endShape(p.CLOSE);

                        p.pop();
                    }
                }

                p.pop(); // End rotor

                // Draw W1 (relative velocity at rotor inlet)
                p.push();
                p.translate(rotorX - 100, -25);
                let w1Angle = -beta1 * Math.PI / 180;
                p.rotate(w1Angle);
                p.stroke(0, 0, 255);
                p.strokeWeight(3);
                p.fill(0, 0, 255);
                p.line(0, 0, 45, 0);
                drawArrowHead(45, 0, 0, p.color(0, 0, 255));
                p.pop();

                p.fill(0, 0, 255);
                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('W₁', rotorX - 100, -45);
                p.textSize(9);
                p.text('β₁=' + beta1.toFixed(0) + '°', rotorX - 100, -35);

                // Draw W2 (relative velocity at rotor outlet)
                p.push();
                p.translate(rotorX + 100, 30);
                let w2Angle = -beta2 * Math.PI / 180;
                p.rotate(w2Angle);
                p.stroke(0, 0, 255);
                p.strokeWeight(3);
                p.fill(0, 0, 255);
                p.line(0, 0, 45, 0);
                drawArrowHead(45, 0, 0, p.color(0, 0, 255));
                p.pop();

                p.fill(0, 0, 255);
                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('W₂', rotorX + 100, 50);
                p.textSize(9);
                p.text('β₂=' + beta2.toFixed(0) + '°', rotorX + 100, 60);

                // Draw outlet flow arrow (V2 - absolute velocity)
                p.push();
                p.translate(280, 20);
                let v2Angle = -alpha2 * Math.PI / 180;
                p.rotate(v2Angle);
                p.stroke(0, 150, 0);
                p.strokeWeight(3);
                p.fill(0, 150, 0);
                p.line(0, 0, 50, 0);
                drawArrowHead(50, 0, 0, p.color(0, 150, 0));
                p.pop();

                p.fill(0, 150, 0);
                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('V₂', 280, 40);
                p.textSize(9);
                p.text('α₂=' + alpha2.toFixed(0) + '°', 280, 50);

                // Flow direction arrow at bottom
                p.stroke(100);
                p.strokeWeight(2);
                p.fill(100);
                p.line(-350, 95, 350, 95);
                p.triangle(350, 95, 340, 92, 340, 98);

                p.noStroke();
                p.textSize(11);
                p.textAlign(p.CENTER);
                p.text('Axial Flow Direction', 0, 92);

                p.pop();
            }

            function drawArrowHead(x, y, rotation, col) {
                p.push();
                p.translate(x, y);
                p.rotate(rotation);
                p.fill(col);
                p.noStroke();
                p.triangle(0, 0, -8, -4, -8, 4);
                p.pop();
            }

            function drawInfoOverlay() {
                // Semi-transparent background - middle right position
                let boxHeight = 135;
                let boxY = (p.height - boxHeight) / 2;

                p.fill(255, 255, 255, 240);
                p.stroke(50);
                p.strokeWeight(1);
                p.rect(p.width - 270, boxY, 260, boxHeight, 5);

                // Text
                p.fill(0);
                p.noStroke();
                p.textSize(13);
                p.textAlign(p.LEFT);

                let x = p.width - 260;
                let y = boxY + 20;
                let lineHeight = 22;

                p.textStyle(p.BOLD);
                p.text('Performance Parameters:', x, y);
                p.textStyle(p.NORMAL);

                y += lineHeight;
                p.text('Specific Work: ' + work.toFixed(2) + ' kJ/kg', x, y);

                y += lineHeight;
                p.text('Power (10 kg/s): ' + power.toFixed(1) + ' kW', x, y);

                y += lineHeight;
                p.text('Reaction: R = ' + reaction.toFixed(3), x, y);

                y += lineHeight;
                p.textSize(11);
                let typeText = machineType === 'turbine' ? 'Power extracted from fluid' : 'Power added to fluid';
                p.text(typeText, x, y);
            }
        }, 'sketch-holder');
    </script>

    <div class="content-section">
        <h2>Engineering Applications</h2>
        <p>Turbomachinery is critical to modern energy and propulsion systems:</p>
        <ul>
            <li><strong>Gas Turbines:</strong> Aircraft jet engines and power generation turbines use multistage axial compressors and turbines. Velocity triangle analysis optimizes each stage for maximum efficiency and power output.</li>
            <li><strong>Steam Turbines:</strong> Power plants use reaction and impulse turbines designed using velocity triangles to extract maximum energy from high-pressure steam while maintaining structural integrity.</li>
            <li><strong>Pumps:</strong> Centrifugal and axial pumps in water treatment, oil pipelines, and chemical processing are designed using the same velocity triangle principles to achieve required pressure rise.</li>
            <li><strong>Compressors:</strong> Turbochargers for automotive engines, industrial air compressors, and refrigeration systems all rely on turbomachinery theory for efficient operation.</li>
            <li><strong>Wind Turbines:</strong> Modern wind turbines use blade element momentum theory, which is based on velocity triangles, to maximize power extraction from wind.</li>
            <li><strong>Hydraulic Turbines:</strong> Hydroelectric dams use Francis, Kaplan, or Pelton turbines designed with velocity triangle analysis for specific head and flow conditions.</li>
        </ul>
    </div>

    <div class="content-section">
        <h2>Summary of Key Equations</h2>
        <div class="equation-table">
            <table>
                <thead>
                    <tr>
                        <th>Concept</th>
                        <th>Equation</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Velocity Triangle</td>
                    <td>\(\vec{V} = \vec{U} + \vec{W}\)</td>
                    <td>Vector relationship</td>
                </tr>
                <tr>
                    <td>Euler Turbine Equation</td>
                    <td>\(W = U_2 V_{\theta 2} - U_1 V_{\theta 1}\)</td>
                    <td>Specific work transfer</td>
                </tr>
                <tr>
                    <td>Power</td>
                    <td>\(\dot{W} = \dot{m}(U_2 V_{\theta 2} - U_1 V_{\theta 1})\)</td>
                    <td>Power transferred</td>
                </tr>
                <tr>
                    <td>Blade Speed</td>
                    <td>\(U = \omega r = 2\pi n r\)</td>
                    <td>Tangential velocity</td>
                </tr>
                <tr>
                    <td>Absolute Flow Angle</td>
                    <td>\(\tan \alpha = \frac{V_\theta}{V_z}\)</td>
                    <td>Angle from axial direction</td>
                </tr>
                <tr>
                    <td>Relative Flow Angle</td>
                    <td>\(\tan \beta = \frac{W_\theta}{W_z}\)</td>
                    <td>Angle in rotating frame</td>
                </tr>
                <tr>
                    <td>Degree of Reaction</td>
                    <td>\(R = \frac{W_1^2 - W_2^2}{V_1^2 - V_2^2 + W_1^2 - W_2^2}\)</td>
                    <td>Rotor pressure rise fraction</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-section">
        <h2>Practice Problems</h2>

        <div class="practice-problems">
            <h3>Problem 1: Axial Turbine Stage</h3>
            <p>An axial turbine stage has a blade speed U = 300 m/s and constant axial velocity Va = 200 m/s. The inlet absolute flow angle is α₁ = 60° and the outlet is α₂ = 20°. Calculate: (a) the specific work output, (b) the power for a mass flow rate of 50 kg/s, and (c) the inlet and outlet relative flow angles.</p>

            <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
            <div id="solution1" class="hidden">
                <p><strong>(a) Calculate tangential velocities:</strong></p>
                <p>\[V_{\theta 1} = V_a \tan\alpha_1 = 200 \times \tan(60°) = 200 \times 1.732 = 346.4 \text{ m/s}\]</p>
                <p>\[V_{\theta 2} = V_a \tan\alpha_2 = 200 \times \tan(20°) = 200 \times 0.364 = 72.8 \text{ m/s}\]</p>
                <p><strong>Specific work (Euler equation):</strong></p>
                <p>\[W = U(V_{\theta 2} - V_{\theta 1}) = 300 \times (72.8 - 346.4) = 300 \times (-273.6) = -82,080 \text{ J/kg}\]</p>
                <p>Work extracted = 82.08 kJ/kg (positive convention for turbine)</p>

                <p><strong>(b) Power output:</strong></p>
                <p>\[\dot{W} = \dot{m} \times W = 50 \times 82.08 = 4,104 \text{ kW} = 4.1 \text{ MW}\]</p>

                <p><strong>(c) Relative flow angles:</strong></p>
                <p>\[W_{\theta 1} = V_{\theta 1} - U = 346.4 - 300 = 46.4 \text{ m/s}\]</p>
                <p>\[\beta_1 = \tan^{-1}\left(\frac{W_{\theta 1}}{V_a}\right) = \tan^{-1}\left(\frac{46.4}{200}\right) = 13.1°\]</p>
                <p>\[W_{\theta 2} = V_{\theta 2} - U = 72.8 - 300 = -227.2 \text{ m/s}\]</p>
                <p>\[\beta_2 = \tan^{-1}\left(\frac{-227.2}{200}\right) = -48.6°\]</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 2: Degree of Reaction</h3>
            <p>For the turbine in Problem 1, calculate the degree of reaction. Interpret what this value means for the pressure distribution in the stage.</p>

            <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
            <div id="solution2" class="hidden">
                <p><strong>Calculate relative velocity magnitudes:</strong></p>
                <p>\[W_1 = \sqrt{V_a^2 + W_{\theta 1}^2} = \sqrt{200^2 + 46.4^2} = \sqrt{40000 + 2153} = 205.4 \text{ m/s}\]</p>
                <p>\[W_2 = \sqrt{V_a^2 + W_{\theta 2}^2} = \sqrt{200^2 + 227.2^2} = \sqrt{40000 + 51620} = 302.7 \text{ m/s}\]</p>

                <p><strong>Degree of reaction:</strong></p>
                <p>\[R = \frac{W_1^2 - W_2^2}{2U(V_{\theta 2} - V_{\theta 1})} = \frac{205.4^2 - 302.7^2}{2 \times 300 \times (72.8 - 346.4)}\]</p>
                <p>\[R = \frac{42189 - 91627}{2 \times 300 \times (-273.6)} = \frac{-49438}{-164160} = 0.301\]</p>

                <p><strong>Interpretation:</strong> R = 0.3 means approximately 30% of the pressure drop occurs in the rotor (moving blades) and 70% in the stator (nozzle/guide vanes). This is closer to an impulse stage, which typically has lower reaction values. Lower reaction stages have higher relative velocities in the rotor, requiring stronger blade materials.</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 3: Compressor Stage Design</h3>
            <p>Design an axial compressor stage with 50% reaction (R = 0.5), blade speed U = 250 m/s, and axial velocity Va = 180 m/s. If the inlet flow is purely axial (α₁ = 0°), find the required outlet flow angle α₂ and the specific work input.</p>

            <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
            <div id="solution3" class="hidden">
                <p><strong>Given conditions:</strong></p>
                <p>α₁ = 0° → V_θ1 = 0 (purely axial inlet)</p>
                <p>For 50% reaction with symmetric velocity triangles: β₁ = α₂ and β₂ = α₁ = 0°</p>

                <p><strong>From inlet conditions:</strong></p>
                <p>\[W_{\theta 1} = V_{\theta 1} - U = 0 - 250 = -250 \text{ m/s}\]</p>
                <p>\[\beta_1 = \tan^{-1}\left(\frac{-250}{180}\right) = -54.2°\]</p>

                <p><strong>For 50% reaction: α₂ = β₁</strong></p>
                <p>\[\alpha_2 = 54.2°\]</p>
                <p>\[V_{\theta 2} = V_a \tan\alpha_2 = 180 \times \tan(54.2°) = 180 \times 1.389 = 250 \text{ m/s}\]</p>

                <p><strong>Specific work input:</strong></p>
                <p>\[W = U(V_{\theta 2} - V_{\theta 1}) = 250 \times (250 - 0) = 62,500 \text{ J/kg} = 62.5 \text{ kJ/kg}\]</p>

                <p><strong>Verification:</strong> For 50% reaction, inlet and outlet velocity triangles are symmetric, which simplifies design and balances loading between rotor and stator.</p>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Knowledge Check Quiz</h2>
        <div class="quiz-container">
            <div class="quiz-question">
                <h3>Question 1: The Euler turbine equation relates work transfer to:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> a) Change in absolute velocity magnitude</label>
                    <label><input type="radio" name="q1" value="b"> b) Change in tangential component of absolute velocity</label>
                    <label><input type="radio" name="q1" value="c"> c) Change in relative velocity magnitude</label>
                    <label><input type="radio" name="q1" value="d"> d) Change in axial velocity</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 2: In the velocity triangle, the relative velocity W is:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> a) V + U</label>
                    <label><input type="radio" name="q2" value="b"> b) V - U</label>
                    <label><input type="radio" name="q2" value="c"> c) U - V</label>
                    <label><input type="radio" name="q2" value="d"> d) Independent of U</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 3: A degree of reaction R = 0 indicates:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> a) All pressure change in rotor</label>
                    <label><input type="radio" name="q3" value="b"> b) All pressure change in stator (impulse stage)</label>
                    <label><input type="radio" name="q3" value="c"> c) Equal pressure change in rotor and stator</label>
                    <label><input type="radio" name="q3" value="d"> d) No pressure change occurs</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 4: For a turbine extracting energy from fluid:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> a) Vθ2 > Vθ1</label>
                    <label><input type="radio" name="q4" value="b"> b) Vθ2 < Vθ1</label>
                    <label><input type="radio" name="q4" value="c"> c) Vθ2 = Vθ1</label>
                    <label><input type="radio" name="q4" value="d"> d) Vθ is always zero</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 5: The blade speed U is calculated as:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> a) U = ωr (angular velocity × radius)</label>
                    <label><input type="radio" name="q5" value="b"> b) U = Va (axial velocity)</label>
                    <label><input type="radio" name="q5" value="c"> c) U = Vθ (tangential component)</label>
                    <label><input type="radio" name="q5" value="d"> d) U = V (absolute velocity)</label>
                </div>
            </div>

            <button id="submit-quiz">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <!-- Common JavaScript functions -->
    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

    <script>
        // Quiz functionality
        document.addEventListener('DOMContentLoaded', function() {
            const quizBtn = document.getElementById('submit-quiz');
            if (quizBtn) {
                quizBtn.addEventListener('click', function() {
                    const answers = {
                        q1: 'b',
                        q2: 'b',
                        q3: 'b',
                        q4: 'b',
                        q5: 'a'
                    };

                    submitQuiz(
                        Object.entries(answers).map(([name, correct]) => ({name, correctAnswer: correct})),
                        'quiz-results'
                    );
                });
            }
        });
    </script>

    <footer>
        <script src="/assets/common/footer.js"></script>
    </footer>
</body>
</html>
