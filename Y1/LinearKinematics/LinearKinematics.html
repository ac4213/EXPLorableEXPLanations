<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Kinematics - Interactive Lecture</title>
    
    <!-- Import p5.js for simulations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <!-- Import MathJax for equations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/problems.css">
    <link rel="stylesheet" href="/assets/css/quizzes.css">
    <link rel="stylesheet" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">

    <!-- Page-specific styles for drag race simulation -->
    <style>
        /* Car Controls - Specific to drag race */
        .car-controls {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            flex: 1;
            min-width: 250px;
        }

        .car1-controls {
            border-color: #ff6b6b;
            background-color: #fff5f5;
        }

        .car2-controls {
            border-color: #4dabf7;
            background-color: #f0f8ff;
        }

        /* Grid layout for two car controls side-by-side */
        .controls-grid-2col {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 20px !important;
            width: 100% !important;
            max-width: 100% !important;
            order: 0 !important;
        }

        .controls-grid-2col .car-controls {
            display: block !important;
            flex: none !important;
            min-width: auto !important;
        }

        /* Race Stats Display */
        .race-stats {
            display: flex;
            justify-content: space-around;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .winner-announcement {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        /* Specific sizing for drag race and acceleration demo */
        #sketch-holder-drag-race, #sketch-holder-acc-demo {
            height: 400px;
        }

        /* Ensure sliders in car controls don't overflow */
        .car-controls .slider-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .car-controls .slider-container label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
        }

        .car-controls .slider-container input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        /* Override simulation-controls to use block flow for drag race */
        .simulation-section .simulation-controls {
            display: flex !important;
            flex-direction: column !important;
            align-items: stretch !important;
            gap: 15px !important;
            justify-content: flex-start !important;
            flex-wrap: nowrap !important;
        }

        /* Race distance slider - full width above car controls */
        .simulation-controls > .slider-container {
            width: 100%;
            order: -1;
            flex-shrink: 0;
        }

        .simulation-controls > .button-group {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 0;
            order: 2;
            flex-shrink: 0;
        }

        /* Responsive adjustments for drag race */
        @media (max-width: 900px) {
            .controls-grid-2col {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .car-controls {
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            #sketch-holder-drag-race, #sketch-holder-acc-demo {
                height: 300px;
            }

            .winner-announcement {
                font-size: 1.2em;
            }

            .race-stats {
                gap: 8px;
                padding: 8px;
            }

            .car-controls {
                padding: 12px;
            }
        }

        @media (max-width: 576px) {
            #sketch-holder-drag-race, #sketch-holder-acc-demo {
                height: 250px;
            }

            .car-controls {
                padding: 10px;
            }
        }

        @media (max-width: 320px) {
            #sketch-holder-drag-race, #sketch-holder-acc-demo {
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Linear Kinematics</h1>
        <p class="subtitle">Motion in One Dimension - Interactive Lecture & Simulations</p>
    </header>

    <div class="content-section">
        <h2>What is Kinematics?</h2>
        <div class="key-point">
            <p><strong>Kinematics</strong> is the branch of mechanics that describes the motion of objects without considering the forces that cause the motion. It focuses purely on the geometry of motion - how things move, not why they move.</p>
        </div>
        
        <p>In kinematics, we study the relationships between:</p>
        <ul>
            <li>Position and displacement</li>
            <li>Velocity (how fast position changes)</li>
            <li>Acceleration (how fast velocity changes)</li>
            <li>Time</li>
        </ul>
        
        <p><strong>Linear kinematics</strong> focuses on motion along a straight line in one dimension (1D).</p>
    </div>

    <div class="content-section">
        <h2>Fundamental Concepts</h2>
        To measure <strong>position</strong>, a <em>reference frame</em> is needed.
        <h3>1. Displacement</h3>
        <div class="equation-box">
            <p><strong>Displacement (Î”s)</strong> is the change in position of an object:</p>
            <p>\(\Delta s = s_f - s_i\)</p>
            <p>Where:</p>
            <ul>
                <li>\(s_f\) = final position</li>
                <li>\(s_i\) = initial position</li>
            </ul>
            <p>as measured within the chosen reference frame.</p>
            <p>SI Unit: metres (m)</p>
            <p>Expressing the displacement as a function of time provides the function \(s(t)\), sometimes called <em>hourly law</em> of motion.</p>
        </div>
        
        <div class="key-point">
            <p><strong>Important:</strong> Displacement is a <em>vector quantity</em>, it has both magnitude and direction. In 1D motion, direction is indicated by the sign (+ or -).</p>
            <p>Displacement differs from distance: distance is always positive (scalar), whilst displacement can be negative.</p>
        </div>
        
        <h3>2. Velocity</h3>
        <div class="equation-box">
            <p><strong>Velocity (v)</strong> is <em>the rate of change of position with respect to time</em>:</p>
            <p>Average velocity: \(v_{\text{avg}} = \displaystyle \frac{\Delta s}{\Delta t} = \frac{s_f - s_i}{t_f - t_i}\)</p>
            <p>Instantaneous velocity: \(v(t) = \displaystyle \frac{ds(t)}{dt}\)</p>
            <p>SI Unit: metres per second (m/s)</p>
        </div>
        
        <p>Velocity tells us two things:</p>
        <ul>
            <li><strong>Speed:</strong> How fast the object is moving (magnitude)</li>
            <li><strong>Direction:</strong> Which way it's moving (sign in 1D)</li>
        </ul>
        
        <h3>3. Acceleration</h3>
        <div class="equation-box">
            <p><strong>Acceleration (a)</strong> is <em>the rate of change of velocity with respect to time</em>:</p>
            <p>Average acceleration: \(a_{\text{avg}} = \displaystyle \frac{\Delta v}{\Delta t} = \frac{v_f - v_i}{t_f - t_i}\)</p>
            <p>Instantaneous acceleration: \(a = \displaystyle \frac{dv(t)}{dt} = \frac{d^2s(t)}{dt^2}\)</p>
            <p>SI Unit: metres per second squared (m/sÂ²)</p>
        </div>
        
        <div class="key-point">
            <p>Depending on the sign of velocity, acceleration can have:</p>
            <ul>
                <li><strong>Same sign:</strong> Object speeding up</li>
                <li><strong>Opposite sign:</strong> Object slowing down</li>
                <li><strong>Zero:</strong> Object moving at constant speed</li>
            </ul>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation: Acceleration & Deceleration</h2>
        <p>Observe how acceleration affects an object's motion. Click to apply acceleration!</p>

        <div id="sketch-holder-acc-demo">
            <!-- Acceleration demo will go here -->
        </div>

        <div class="simulation-controls">
            <div class="slider-container">
                <label>Applied Acceleration: <span id="acc-demo-value" class="value-display">5.0 m/sÂ²</span></label>
                <input type="range" id="acc-demo-slider" min="-10" max="10" step="0.5" value="5">
            </div>
            <div class="button-group">
                <button id="reset-acc-demo">RESET</button>
            </div>
            <p style="text-align: center;"><em>Click and hold on the track to apply acceleration. Release to coast at constant velocity.</em></p>
        </div>
    </div>

    <div class="content-section">
        <h2>Equations of Motion</h2>
        <p>For constant acceleration, we have five key kinematic equations:</p>
        
        <div class="equation-box">
            <h3>The SUVAT Equations</h3>
            <ol>
                <li>\(v = u + a_0t\)</li>
                <li>\(s = ut + \frac{1}{2}a_0t^2\)</li>
                <li>\(v^2 = u^2 + 2as\)</li>
                <li>\(s = \frac{(u + v)t}{2}\)</li>
                <li>\(s = vt - \frac{1}{2}at^2\)</li>
            </ol>
            <p>Where:</p>
            <ul>
                <li>\(s\) = displacement</li>
                <li>\(u\) = initial velocity</li>
                <li>\(v\) = final velocity</li>
                <li>\(a_0\) = acceleration <strong>(constant)</strong></li>
                <li>\(t\) = time</li>
            </ul>
        </div>
        
        <div class="key-point">
            <p><strong>NOTA BENE:</strong> These equations only apply when acceleration is <strong>constant</strong>. </p>
            <p>For varying acceleration, we need calculus methods (integration).</p>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation: Drag Race</h2>
        <p>Set the initial velocities and accelerations for two cars and watch them race to the finish line!</p>
        
        <div id="sketch-holder-drag-race">
            <!-- Drag race simulation will go here -->
        </div>
        
        <div class="simulation-controls">
            <div class="controls-grid-2col">
                <div class="car-controls car1-controls">
                    <h4 style="color: #ff6b6b;">Red Car</h4>
                    <div class="slider-container">
                        <label>Initial Velocity: <span id="car1-v0-value" class="value-display">10.0 m/s</span></label>
                        <input type="range" id="car1-v0" min="0" max="30" step="0.5" value="10">
                    </div>
                    <div class="slider-container">
                        <label>Acceleration: <span id="car1-acc-value" class="value-display">2.0 m/sÂ²</span></label>
                        <input type="range" id="car1-acc" min="-5" max="10" step="0.1" value="2">
                    </div>
                </div>

                <div class="car-controls car2-controls">
                    <h4 style="color: #4dabf7;">Blue Car</h4>
                    <div class="slider-container">
                        <label>Initial Velocity: <span id="car2-v0-value" class="value-display">5.0 m/s</span></label>
                        <input type="range" id="car2-v0" min="0" max="30" step="0.5" value="5">
                    </div>
                    <div class="slider-container">
                        <label>Acceleration: <span id="car2-acc-value" class="value-display">3.0 m/sÂ²</span></label>
                        <input type="range" id="car2-acc" min="-5" max="10" step="0.1" value="3">
                    </div>
                </div>
            </div>

            <div class="slider-container">
                <label>Race Distance: <span id="race-distance-value" class="value-display">200 m</span></label>
                <input type="range" id="race-distance" min="50" max="500" step="10" value="200">
            </div>

            <div class="button-group">
                <button id="start-race">START RACE</button>
                <button id="reset-race">RESET</button>
            </div>
        </div>
        
    </div>

    <div class="content-section">
        <h2>Engineering Applications</h2>
        
        <h3>Transport Engineering</h3>
        <ul>
            <li><strong>Railway Design:</strong> Calculating safe braking distances and acceleration zones</li>
            <li><strong>Traffic Engineering:</strong> Determining stopping sight distances for road design</li>
            <li><strong>Airport Runways:</strong> Calculating required runway lengths for aircraft take-off and landing</li>
        </ul>
        
        <h3>Vehicle Performance</h3>
        <ul>
            <li><strong>0-60 mph Times:</strong> Measuring vehicle acceleration performance</li>
            <li><strong>Braking Systems:</strong> Designing systems that provide optimal deceleration</li>
            <li><strong>Fuel Efficiency:</strong> Optimising acceleration profiles for minimal fuel consumption</li>
        </ul>
        
        <h3>Manufacturing & Robotics</h3>
        <ul>
            <li><strong>Conveyor Systems:</strong> Controlling product movement through production lines</li>
            <li><strong>Robot Arms:</strong> Programming smooth motion profiles for precise positioning</li>
            <li><strong>CNC Machines:</strong> Optimising tool paths for efficiency and accuracy</li>
        </ul>
        
        <div class="key-point">
            <p><strong>Engineering Insight:</strong> In real-world applications, engineers must consider jerk (rate of change of acceleration) to ensure smooth motion and prevent mechanical stress. Sudden changes in acceleration can cause discomfort to passengers or damage to machinery.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Summary of Key Equations</h2>
        <div class="equation-table">
            <table>
                <thead>
                    <tr>
                        <th>Concept</th>
                        <th>Equation</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Velocity</td>
                    <td>\(v = u + at\)</td>
                    <td>Final velocity from initial velocity and acceleration</td>
                </tr>
                <tr>
                    <td>Displacement (time)</td>
                    <td>\(s = ut + \frac{1}{2}at^2\)</td>
                    <td>Displacement as function of time</td>
                </tr>
                <tr>
                    <td>Displacement (velocity)</td>
                    <td>\(v^2 = u^2 + 2as\)</td>
                    <td>Velocity-displacement relationship</td>
                </tr>
                <tr>
                    <td>Average Velocity</td>
                    <td>\(v_{avg} = \frac{u + v}{2}\)</td>
                    <td>Average velocity under constant acceleration</td>
                </tr>
                <tr>
                    <td>Displacement (average)</td>
                    <td>\(s = v_{avg} \cdot t\)</td>
                    <td>Displacement from average velocity</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-section">
        <h2>Practice Problems</h2>

        <div class="practice-problems">
            <h3>Problem 1: Emergency Braking</h3>
            <p>A car travelling at 30 m/s (108 km/h) needs to make an emergency stop. If the maximum deceleration is 8 m/sÂ², calculate:</p>
            <ol>
                <li>The stopping distance</li>
                <li>The time taken to stop</li>
            </ol>

            <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
            <div id="solution1" class="hidden">
                <p>Given: \(u = 30\) m/s, \(v = 0\) m/s (stops), \(a = -8\) m/sÂ²</p>

                <p><strong>a) Stopping distance:</strong></p>
                <p>Using: \(v^2 = u^2 + 2as\)</p>
                <p>\(0 = 30^2 + 2(-8)s\)</p>
                <p>\(0 = 900 - 16s\)</p>
                <p>\(s = \frac{900}{16} = 56.25\) m</p>

                <p><strong>b) Time to stop:</strong></p>
                <p>Using: \(v = u + at\)</p>
                <p>\(0 = 30 + (-8)t\)</p>
                <p>\(t = \frac{30}{8} = 3.75\) s</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 2: Overtaking Manoeuvre</h3>
            <p>A car travelling at 20 m/s begins to overtake a lorry. It accelerates at 2 m/sÂ² for 5 seconds. Calculate:</p>
            <ol>
                <li>The final velocity</li>
                <li>The distance covered during acceleration</li>
            </ol>

            <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
            <div id="solution2" class="hidden">
                <p>Given: \(u = 20\) m/s, \(a = 2\) m/sÂ², \(t = 5\) s</p>

                <p><strong>a) Final velocity:</strong></p>
                <p>Using: \(v = u + at\)</p>
                <p>\(v = 20 + 2(5) = 30\) m/s</p>

                <p><strong>b) Distance covered:</strong></p>
                <p>Using: \(s = ut + \frac{1}{2}at^2\)</p>
                <p>\(s = 20(5) + \frac{1}{2}(2)(5^2)\)</p>
                <p>\(s = 100 + 25 = 125\) m</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 3: Two-Stage Motion</h3>
            <p>A train accelerates from rest at 1.5 m/sÂ² for 20 seconds, then travels at constant velocity for 60 seconds. Find the total distance travelled.</p>

            <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
            <div id="solution3" class="hidden">
                <p><strong>Stage 1: Acceleration</strong></p>
                <p>Given: \(u = 0\) m/s, \(a = 1.5\) m/sÂ², \(t = 20\) s</p>
                <p>Distance: \(s_1 = ut + \frac{1}{2}at^2 = 0 + \frac{1}{2}(1.5)(20^2) = 300\) m</p>
                <p>Final velocity: \(v = u + at = 0 + 1.5(20) = 30\) m/s</p>

                <p><strong>Stage 2: Constant velocity</strong></p>
                <p>Given: \(v = 30\) m/s, \(t = 60\) s</p>
                <p>Distance: \(s_2 = vt = 30(60) = 1800\) m</p>

                <p><strong>Total distance:</strong> \(s_{total} = s_1 + s_2 = 300 + 1800 = 2100\) m</p>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Knowledge Check Quiz</h2>
        <div class="quiz-container">
            <div class="quiz-question">
                <h3>Question 1: Which of the following is NOT a vector quantity?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> a) Displacement</label>
                    <label><input type="radio" name="q1" value="b"> b) Velocity</label>
                    <label><input type="radio" name="q1" value="c"> c) Distance</label>
                    <label><input type="radio" name="q1" value="d"> d) Acceleration</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>Question 2: A car decelerates uniformly from 25 m/s to rest over 50 m. What is its acceleration?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> a) -12.5 m/sÂ²</label>
                    <label><input type="radio" name="q2" value="b"> b) -6.25 m/sÂ²</label>
                    <label><input type="radio" name="q2" value="c"> c) -2.5 m/sÂ²</label>
                    <label><input type="radio" name="q2" value="d"> d) -5.0 m/sÂ²</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>Question 3: An object has negative velocity and negative acceleration. The object is:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> a) Speeding up in the positive direction</label>
                    <label><input type="radio" name="q3" value="b"> b) Slowing down in the negative direction</label>
                    <label><input type="radio" name="q3" value="c"> c) Speeding up in the negative direction</label>
                    <label><input type="radio" name="q3" value="d"> d) Slowing down in the positive direction</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>Question 4: Which kinematic equation would you use to find time if you know initial velocity, final velocity, and displacement?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> a) \(v = u + at\)</label>
                    <label><input type="radio" name="q4" value="b"> b) \(s = ut + \frac{1}{2}at^2\)</label>
                    <label><input type="radio" name="q4" value="c"> c) \(v^2 = u^2 + 2as\)</label>
                    <label><input type="radio" name="q4" value="d"> d) \(s = \frac{(u + v)t}{2}\)</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 5: A ball is thrown vertically upward with an initial velocity of 20 m/s. What is its velocity at the highest point? (Ignore air resistance, g = 9.8 m/sÂ²)</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> a) 20 m/s upward</label>
                    <label><input type="radio" name="q5" value="b"> b) 10 m/s upward</label>
                    <label><input type="radio" name="q5" value="c"> c) 0 m/s</label>
                    <label><input type="radio" name="q5" value="d"> d) 9.8 m/s downward</label>
                </div>
            </div>

            <button id="submit-quiz">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <footer>
        <script src="/assets/common/footer.js"></script>
    </footer>

    <!-- Common JavaScript functions -->
    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

    <!-- p5.js sketches -->
    <script>
        // Drag Race Simulation
        let dragRaceSketch = function(p) {
            let car1, car2;
            let raceDistance = 200;
            let racing = false;
            let raceComplete = false;
            let startTime;
            let scaleFactor = 1.5; // pixels per metre
            let winnerText = '';
            let winnerColor = '';
            
            class Car {
                constructor(y, colour, v0, acc) {
                    this.startY = y;
                    this.y = y;
                    this.x = 50;
                    this.colour = colour;
                    this.v0 = v0;
                    this.v = v0;
                    this.acc = acc;
                    this.s = 0;
                    this.finished = false;
                    this.finishTime = 0;
                }
                
                reset() {
                    this.x = 50;
                    this.s = 0;
                    this.v = this.v0;
                    this.finished = false;
                    this.finishTime = 0;
                }
                
                update(t) {
                    if (!this.finished) {
                        // s = ut + 0.5atÂ²
                        this.s = this.v0 * t + 0.5 * this.acc * t * t;
                        // v = u + at
                        this.v = this.v0 + this.acc * t;
                        
                        this.x = 50 + this.s * scaleFactor;
                        
                        if (this.s >= raceDistance) {
                            this.finished = true;
                            // Calculate exact finish time using quadratic formula
                            if (this.acc !== 0) {
                                let a = 0.5 * this.acc;
                                let b = this.v0;
                                let c = -raceDistance;
                                this.finishTime = (-b + Math.sqrt(b*b - 4*a*c)) / (2*a);
                            } else if (this.v0 !== 0) {
                                this.finishTime = raceDistance / this.v0;
                            }
                            this.v = this.v0 + this.acc * this.finishTime;
                        }
                    }
                }
                
                draw(p) {
                    p.push();
                    p.fill(this.colour);
                    p.noStroke();
                    // Car body
                    p.rect(this.x - 20, this.y - 8, 40, 16, 3);
                    // Windows
                    p.fill(200, 200, 255);
                    p.rect(this.x - 5, this.y - 6, 15, 8, 2);
                    // Wheels
                    p.fill(50);
                    p.ellipse(this.x - 12, this.y + 8, 8, 8);
                    p.ellipse(this.x + 12, this.y + 8, 8, 8);
                    
                    // Speed indicator
                    p.fill(0);
                    p.textAlign(p.LEFT);
                    p.text(`${this.v.toFixed(1)} m/s`, this.x + 25, this.y);
                    p.pop();
                }
            }
            
            p.setup = function() {
                let canvas = p.createCanvas(800, 400);
                canvas.parent('sketch-holder-drag-race');
                
                car1 = new Car(150, p.color(255, 107, 107), 10, 2);
                car2 = new Car(250, p.color(77, 171, 247), 5, 3);
                
                p.textFont('Arial');
                p.textSize(12);
            };
            
            p.draw = function() {
                p.background(240);
                
                // Draw track
                p.fill(100);
                p.rect(0, 100, p.width, 200);
                
                // Draw lanes
                p.stroke(255);
                p.strokeWeight(2);
                //for (let i = 1; i <= 2; i++) {
                //    p.line(0, 100 + i * 66, p.width, 100 + i * 66);
                //}
                
                // Draw centre line (dashed)
                p.strokeWeight(1);
                p.drawingContext.setLineDash([10, 10]);
                p.line(0, 200, p.width, 200);
                p.drawingContext.setLineDash([]);
                
                // Draw start line
                p.stroke(255);
                p.strokeWeight(4);
                p.line(50, 100, 50, 300);
                
                // Draw finish line
                let finishX = 50 + raceDistance * scaleFactor;
                p.stroke(255, 255, 0);
                p.strokeWeight(4);
                p.line(finishX, 100, finishX, 300);
                
                // Draw chequered pattern at finish (constrained to track bounds)
                p.noStroke();
                let checkSize = 20;
                let numChecks = Math.floor(200 / checkSize); // 200 = track height
                for (let j = 0; j < numChecks; j++) {
                    if (j % 2 === 0) {
                        p.fill(0);
                    } else {
                        p.fill(255);
                    }
                    p.rect(finishX, 100 + j * checkSize, 10, checkSize);
                }
                
                // Draw distance markers
                p.fill(0);
                p.noStroke();
                p.textAlign(p.CENTER);
                for (let d = 0; d <= raceDistance; d += 50) {
                    let x = 50 + d * scaleFactor;
                    p.text(`${d}m`, x, 90);
                }
                
                // Update and draw cars
                if (racing && !raceComplete) {
                    let t = (p.millis() - startTime) / 1000;
                    car1.update(t);
                    car2.update(t);
                    
                    if (car1.finished && car2.finished) {
                        raceComplete = true;
                        showResults();
                    }
                }
                
                car1.draw(p);
                car2.draw(p);
                
                // Draw position indicators
                p.fill(255, 107, 107);
                p.textAlign(p.LEFT);
                p.text(`Red: ${car1.s.toFixed(1)}m`, 10, 30);
                p.fill(77, 171, 247);
                p.text(`Blue: ${car2.s.toFixed(1)}m`, 10, 50);
                
                // Draw time
                if (racing) {
                    let t = raceComplete ?
                        Math.max(car1.finishTime || 0, car2.finishTime || 0) :
                        (p.millis() - startTime) / 1000;
                    p.fill(0);
                    p.textAlign(p.CENTER);
                    p.textSize(20);
                    p.text(`Time: ${t.toFixed(2)}s`, p.width/2, 30);
                    p.textSize(12);
                }

                // Draw race results as info boxes on canvas
                if (raceComplete) {
                    // Red car stats (top left)
                    p.push();
                    p.fill(255, 107, 107, 240);
                    p.stroke(200, 80, 80);
                    p.strokeWeight(2);
                    p.rect(10, 120, 150, 60, 5);
                    p.noStroke();
                    p.fill(0);
                    p.textAlign(p.LEFT, p.TOP);
                    p.textSize(14);
                    p.textStyle(p.BOLD);
                    p.text('Red Car', 20, 130);
                    p.textStyle(p.NORMAL);
                    p.textSize(12);
                    p.text(`Time: ${car1.finishTime.toFixed(2)} s`, 20, 150);
                    p.text(`Final v: ${car1.v.toFixed(1)} m/s`, 20, 165);
                    p.pop();

                    // Blue car stats (bottom left)
                    p.push();
                    p.fill(77, 171, 247, 240);
                    p.stroke(50, 130, 200);
                    p.strokeWeight(2);
                    p.rect(10, 220, 150, 60, 5);
                    p.noStroke();
                    p.fill(0);
                    p.textAlign(p.LEFT, p.TOP);
                    p.textSize(14);
                    p.textStyle(p.BOLD);
                    p.text('Blue Car', 20, 230);
                    p.textStyle(p.NORMAL);
                    p.textSize(12);
                    p.text(`Time: ${car2.finishTime.toFixed(2)} s`, 20, 250);
                    p.text(`Final v: ${car2.v.toFixed(1)} m/s`, 20, 265);
                    p.pop();

                    // Winner announcement (center)
                    p.push();
                    p.fill(winnerColor);
                    p.stroke(0);
                    p.strokeWeight(2);
                    p.rect(p.width/2 - 120, 190, 240, 50, 5);
                    p.noStroke();
                    p.fill(0);
                    p.textAlign(p.CENTER, p.CENTER);
                    p.textSize(18);
                    p.textStyle(p.BOLD);
                    p.text(winnerText, p.width/2, 215);
                    p.pop();
                }
            };
            
            window.startRace = function() {
                // Get values from sliders
                car1.v0 = parseFloat(document.getElementById('car1-v0').value);
                car1.acc = parseFloat(document.getElementById('car1-acc').value);
                car2.v0 = parseFloat(document.getElementById('car2-v0').value);
                car2.acc = parseFloat(document.getElementById('car2-acc').value);
                raceDistance = parseFloat(document.getElementById('race-distance').value);
                
                // Adjust scale factor based on race distance
                scaleFactor = Math.min(700 / raceDistance, 3);
                
                // Reset cars
                car1.reset();
                car2.reset();
                
                // Start race
                racing = true;
                raceComplete = false;
                startTime = p.millis();
                winnerText = '';
                winnerColor = '';
            };

            window.resetRace = function() {
                racing = false;
                raceComplete = false;
                car1.reset();
                car2.reset();
                winnerText = '';
                winnerColor = '';
            };

            window.updateRaceDistance = function(newDistance) {
                raceDistance = newDistance;
                // Adjust scale factor based on race distance
                scaleFactor = Math.min(700 / raceDistance, 3);
            };

            function showResults() {
                // Results now drawn on canvas
                if (car1.finishTime < car2.finishTime) {
                    winnerText = 'ðŸ† Red Car Wins! ðŸ†';
                    winnerColor = p.color(255, 235, 238);
                } else if (car2.finishTime < car1.finishTime) {
                    winnerText = 'ðŸ† Blue Car Wins! ðŸ†';
                    winnerColor = p.color(227, 242, 253);
                } else {
                    winnerText = "ðŸ It's a Tie! ðŸ";
                    winnerColor = p.color(255, 243, 205);
                }
            }
        };
        
        // Acceleration Demo Simulation
        let accDemoSketch = function(p) {
            let object;
            let acceleration = 5;
            let applying = false;
            let trail = [];
            
            class MovingObject {
                constructor() {
                    this.reset();
                }
                
                reset() {
                    this.x = 50;
                    this.v = 10; // Start with initial velocity
                    this.a = 0;
                    trail = [];
                }
                
                update() {
                    this.a = applying ? acceleration : 0;
                    this.v += this.a * 0.016; // Assuming 60fps
                    
                    // Limit velocity
                    this.v = p.constrain(this.v, -50, 50);
                    
                    this.x += this.v * 0.016 * 10; // Scale for visibility
                    
                    // Wrap around
                    if (this.x > p.width + 20) {
                        this.x = -20;
                    } else if (this.x < -20) {
                        this.x = p.width + 20;
                    }
                    
                    // Add to trail
                    trail.push({x: this.x, y: p.height/2});
                    if (trail.length > 50) {
                        trail.shift();
                    }
                }
                
                draw(p) {
                    // Draw trail
                    p.noFill();
                    p.strokeWeight(2);
                    for (let i = 0; i < trail.length - 1; i++) {
                        let alpha = p.map(i, 0, trail.length, 0, 100);
                        p.stroke(100, 150, 255, alpha);
                        p.line(trail[i].x, trail[i].y, trail[i+1].x, trail[i+1].y);
                    }
                    
                    // Draw object
                    p.push();
                    p.fill(100, 150, 255);
                    p.noStroke();
                    p.rectMode(p.CENTER);
                    p.rect(this.x, p.height/2, 30, 30, 5);
                    p.pop();
                    
                    // Draw velocity vector
                    p.stroke(255, 100, 100);
                    p.strokeWeight(3);
                    let vx = this.x + this.v * 2;
                    p.line(this.x, p.height/2 - 40, vx, p.height/2 - 40);
                    // Arrowhead
                    p.push();
                    p.translate(vx, p.height/2 - 40);
                    p.rotate(this.v > 0 ? 0 : p.PI);
                    p.noStroke();
                    p.fill(255, 100, 100);
                    p.triangle(0, 0, -8, -5, -8, 5);
                    p.pop();
                    
                    // Draw acceleration vector if applying
                    if (applying && this.a !== 0) {
                        p.stroke(100, 255, 100);
                        p.strokeWeight(3);
                        let ax = this.x + this.a * 10;
                        p.line(this.x, p.height/2 + 40, ax, p.height/2 + 40);
                        // Arrowhead
                        p.push();
                        p.translate(ax, p.height/2 + 40);
                        p.rotate(this.a > 0 ? 0 : p.PI);
                        p.noStroke();
                        p.fill(100, 255, 100);
                        p.triangle(0, 0, -8, -5, -8, 5);
                        p.pop();
                    }
                }
            }
            
            p.setup = function() {
                let canvas = p.createCanvas(800, 400);
                canvas.parent('sketch-holder-acc-demo');
                canvas.mousePressed(() => applying = true);
                canvas.mouseReleased(() => applying = false);
                canvas.touchStarted(() => { applying = true; return false; });
                canvas.touchEnded(() => { applying = false; return false; });
                
                object = new MovingObject();
                p.textFont('Arial');
            };
            
            p.draw = function() {
                p.background(240);
                
                // Draw track
                p.fill(180);
                p.noStroke();
                p.rect(0, p.height/2 - 60, p.width, 120);
                
                // Draw grid lines
                p.stroke(200);
                p.strokeWeight(1);
                for (let x = 0; x < p.width; x += 50) {
                    p.line(x, p.height/2 - 60, x, p.height/2 + 60);
                }
                
                // Update and draw object
                object.update();
                object.draw(p);
                
                // Draw info
                p.fill(0);
                p.noStroke();
                p.textAlign(p.LEFT);
                p.textSize(14);
                p.text(`Velocity: ${object.v.toFixed(1)} m/s`, 10, 30);
                p.text(`Acceleration: ${object.a.toFixed(1)} m/sÂ²`, 10, 50);
                
                // Draw legend
                p.textAlign(p.RIGHT);
                p.fill(255, 100, 100);
                p.text('Velocity â†’', p.width - 10, 30);
                p.fill(100, 255, 100);
                p.text('Acceleration â†’', p.width - 10, 50);
                
                // Instructions
                if (!applying) {
                    p.fill(100);
                    p.textAlign(p.CENTER);
                    p.text('Click/Touch and hold to apply acceleration', p.width/2, p.height - 20);
                } else {
                    p.fill(100, 255, 100);
                    p.textAlign(p.CENTER);
                    p.text('Applying acceleration...', p.width/2, p.height - 20);
                }
            };
            
            window.resetAccDemo = function() {
                object.reset();
            };
            
            window.updateAcceleration = function(value) {
                acceleration = parseFloat(value);
            };
        };
        
        // Create p5 instances
        new p5(dragRaceSketch);
        new p5(accDemoSketch);
        
        // Slider updates
        document.addEventListener('DOMContentLoaded', function() {
            // Drag race sliders
            const car1V0 = document.getElementById('car1-v0');
            const car1Acc = document.getElementById('car1-acc');
            const car2V0 = document.getElementById('car2-v0');
            const car2Acc = document.getElementById('car2-acc');
            const raceDistSlider = document.getElementById('race-distance');
            
            car1V0.addEventListener('input', e => {
                document.getElementById('car1-v0-value').textContent = parseFloat(e.target.value).toFixed(1);
            });
            car1Acc.addEventListener('input', e => {
                document.getElementById('car1-acc-value').textContent = parseFloat(e.target.value).toFixed(1);
            });
            car2V0.addEventListener('input', e => {
                document.getElementById('car2-v0-value').textContent = parseFloat(e.target.value).toFixed(1);
            });
            car2Acc.addEventListener('input', e => {
                document.getElementById('car2-acc-value').textContent = parseFloat(e.target.value).toFixed(1);
            });
            raceDistSlider.addEventListener('input', e => {
                document.getElementById('race-distance-value').textContent = e.target.value;
                // Update race distance in real time
                window.updateRaceDistance(parseFloat(e.target.value));
            });
            
            // Acceleration demo slider
            const accDemoSlider = document.getElementById('acc-demo-slider');
            accDemoSlider.addEventListener('input', e => {
                document.getElementById('acc-demo-value').textContent = parseFloat(e.target.value).toFixed(1);
                window.updateAcceleration(e.target.value);
            });
            
            // Buttons
            document.getElementById('start-race').addEventListener('click', window.startRace);
            document.getElementById('reset-race').addEventListener('click', window.resetRace);
            document.getElementById('reset-acc-demo').addEventListener('click', window.resetAccDemo);
            
            // Quiz
            document.getElementById('submit-quiz').addEventListener('click', function() {
                const answers = {
                    q1: 'c', // Distance is scalar
                    q2: 'b', // -6.25 m/sÂ²
                    q3: 'c', // Speeding up in negative direction
                    q4: 'd', // s = (u+v)t/2
                    q5: 'c'  // Velocity at highest point is 0
                };

                let score = 0;
                let totalQuestions = Object.keys(answers).length;
                let resultsHTML = '<h3>Quiz Results:</h3>';

                for (let question in answers) {
                    const selected = document.querySelector(`input[name="${question}"]:checked`);
                    const correctAnswer = answers[question];

                    if (selected) {
                        if (selected.value === correctAnswer) {
                            score++;
                            resultsHTML += `<p style="color: #28a745; font-weight: bold;">${question.toUpperCase()}: Correct! âœ“</p>`;
                        } else {
                            resultsHTML += `<p style="color: #dc3545; font-weight: bold;">${question.toUpperCase()}: Incorrect âœ—</p>`;
                        }
                    } else {
                        resultsHTML += `<p style="color: #333;">${question.toUpperCase()}: Not answered</p>`;
                    }
                }

                const percentage = ((score / totalQuestions) * 100).toFixed(0);
                resultsHTML = `<p style="font-size: 1.2em; font-weight: bold;">You scored ${score} out of ${totalQuestions} (${percentage}%)</p>` + resultsHTML;

                document.getElementById('quiz-results').innerHTML = resultsHTML;
            });
        });

        // toggleSolution function now loaded from /assets/common/problems.js
    </script>
</body>
</html>