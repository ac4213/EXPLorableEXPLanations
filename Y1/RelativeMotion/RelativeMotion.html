<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relative Motion in 2D - Interactive Lecture</title>
    
    <!-- Import p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <!-- Import MathJax for LaTeX rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/problems.css">
    <link rel="stylesheet" href="/assets/css/quizzes.css">
    <link rel="stylesheet" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">

    <style>
        /* Page-specific styles for relative motion simulation */
        .pov-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .pov-button {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .pov-button.active {
            background-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .pov-button:hover {
            background-color: var(--primary-color);
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .controls-grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
            min-width: 0;
            max-width: 900px;
        }

        .object-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .object-controls h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .button-group button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .button-group button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        #sketch-holder {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .velocity-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.75);
            border: 2px solid rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-width: 250px;
            font-size: 0.9em;
            backdrop-filter: blur(8px);
            pointer-events: none;
        }

        .velocity-card {
            margin: 0;
            padding: 0;
            border: none;
            background-color: transparent;
        }

        .velocity-card.hidden {
            display: none;
        }

        .velocity-card h4 {
            margin: 0 0 5px 0;
            color: var(--primary-color);
            font-size: 0.95em;
        }

        .velocity-card p {
            margin: 2px 0;
            font-size: 0.85em;
            line-height: 1.3;
        }

    </style>
</head>
<body>
    <header>
        <h1>Relative Motion in 2D</h1>
        <p class="subtitle">Understanding Motion from Different Perspectives</p>
    </header>

    <div class="content-section">
        <h2>Introduction to Relative Motion</h2>
        <p>In the real world, motion is always observed from a particular <strong>frame of reference</strong>. What appears to be motion from one perspective might appear completely different from another. This concept is fundamental to understanding dynamics and is crucial in many engineering applications.</p>
        
        <div class="key-point">
            <p><strong>Key Principle:</strong> All motion is relative. There is no such thing as absolute motion – motion can only be described relative to a chosen reference frame.</p>
        </div>
        
        <h3>Everyday Examples</h3>
        <ul>
            <li>A passenger on a train sees the platform moving backwards, whilst a person on the platform sees the train moving forwards</li>
            <li>To someone in a car, roadside objects appear to move backwards</li>
            <li>The Sun appears to move across the sky from Earth's perspective, but Earth orbits the Sun</li>
        </ul>
    </div>

    <div class="content-section">
        <h2>Relative Displacement in 2D</h2>
        
        <div class="equation-box">
            <p><strong>Definition:</strong> The relative displacement of object B with respect to object A is the vector difference between their position vectors:</p>
            <p>\(\vec{r}_{B/A} = \vec{r}_B - \vec{r}_A\)</p>
            <p>Where:</p>
            <ul>
                <li>\(\vec{r}_{B/A}\) = position of B relative to A</li>
                <li>\(\vec{r}_B\) = position of B from the origin</li>
                <li>\(\vec{r}_A\) = position of A from the origin</li>
            </ul>
        </div>
        
        <h3>Component Form</h3>
        <div class="equation-box">
            <p>In 2D Cartesian coordinates:</p>
            <p>\(\vec{r}_{B/A} = (x_B - x_A)\hat{i} + (y_B - y_A)\hat{j}\)</p>
            <p>Magnitude: \(|\vec{r}_{B/A}| = \sqrt{(x_B - x_A)^2 + (y_B - y_A)^2}\)</p>
            <p>Direction: \(\theta = \tan^{-1}\left(\frac{y_B - y_A}{x_B - x_A}\right)\)</p>
        </div>
        
        <div class="key-point">
            <p><strong>Important Property:</strong> \(\vec{r}_{B/A} = -\vec{r}_{A/B}\)</p>
            <p>The position of B relative to A is the negative of the position of A relative to B.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Relative Velocity in 2D</h2>
        
        <div class="equation-box">
            <p><strong>Definition:</strong> The relative velocity of object B with respect to object A is the vector difference between their velocity vectors:</p>
            <p>\(\vec{v}_{B/A} = \vec{v}_B - \vec{v}_A\)</p>
            <p>Where:</p>
            <ul>
                <li>\(\vec{v}_{B/A}\) = velocity of B relative to A</li>
                <li>\(\vec{v}_B\) = velocity of B in the fixed frame</li>
                <li>\(\vec{v}_A\) = velocity of A in the fixed frame</li>
            </ul>
        </div>
        
        <h3>Velocity Addition Formula</h3>
        <div class="equation-box">
            <p>For three reference frames (e.g., A, B, and ground G):</p>
            <p>\(\vec{v}_{B/G} = \vec{v}_{B/A} + \vec{v}_{A/G}\)</p>
            <p>This states that the velocity of B relative to the ground equals the velocity of B relative to A plus the velocity of A relative to the ground.</p>
        </div>
        
        <h3>Component Form</h3>
        <div class="equation-box">
            <p>In 2D Cartesian coordinates:</p>
            <p>\(\vec{v}_{B/A} = (v_{Bx} - v_{Ax})\hat{i} + (v_{By} - v_{Ay})\hat{j}\)</p>
            <p>Speed: \(|\vec{v}_{B/A}| = \sqrt{(v_{Bx} - v_{Ax})^2 + (v_{By} - v_{Ay})^2}\)</p>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation</h2>
        <p>Explore relative motion by observing two objects from different reference frames. Switch between viewpoints to see how motion appears different from each perspective.</p>
        
        <div class="pov-buttons">
            <button class="pov-button active" id="pov-ground">Stationary Observer</button>
            <button class="pov-button" id="pov-object1">Object A Viewpoint</button>
            <button class="pov-button" id="pov-object2">Object B Viewpoint</button>
        </div>
        
        <div id="sketch-holder">
            <!-- p5.js sketch will go here -->
            <div class="velocity-info">
                <div class="velocity-card" id="card-absolute">
                    <h4>Absolute Velocities</h4>
                    <p><strong>A:</strong> <span id="vel-a">2.0 m/s @ 45°</span></p>
                    <p><strong>B:</strong> <span id="vel-b">3.0 m/s @ 135°</span></p>
                </div>
                <div class="velocity-card" id="card-relative-ba" class="hidden">
                    <h4>B relative to A</h4>
                    <p><span id="vel-rel-ba">3.61 m/s @ angle</span></p>
                </div>
                <div class="velocity-card" id="card-relative-ab" class="hidden">
                    <h4>A relative to B</h4>
                    <p><span id="vel-rel-ab">3.61 m/s @ angle</span></p>
                </div>
            </div>
        </div>
        
        <div class="control-panel">
            <div class="controls-grid-2col">
                <div class="object-controls">
                    <h3>Object A</h3>
                    <div class="slider-container">
                        <label>Speed: <span id="speed1-value" class="value-display">2.0 m/s</span></label>
                        <input type="range" id="speed1" min="0" max="5" step="0.1" value="2">
                    </div>
                    <div class="slider-container">
                        <label>Direction: <span id="angle1-value" class="value-display">45°</span></label>
                        <input type="range" id="angle1" min="0" max="360" step="1" value="45">
                    </div>
                </div>

                <div class="object-controls">
                    <h3>Object B</h3>
                    <div class="slider-container">
                        <label>Speed: <span id="speed2-value" class="value-display">3.0 m/s</span></label>
                        <input type="range" id="speed2" min="0" max="5" step="0.1" value="3">
                    </div>
                    <div class="slider-container">
                        <label>Direction: <span id="angle2-value" class="value-display">135°</span></label>
                        <input type="range" id="angle2" min="0" max="360" step="1" value="135">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button id="reset-button">Reset Positions</button>
                <button id="pause-button">Pause/Play</button>
                <button id="toggle-grid">Toggle Grid</button>
                <button id="toggle-trails">Toggle Trails</button>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Engineering Applications</h2>

        <h3>Navigation and Transport</h3>
        <ul>
            <li><strong>Aircraft Navigation:</strong> Pilots must account for wind velocity to determine ground speed and heading</li>
            <li><strong>Marine Engineering:</strong> Ships must consider ocean currents when plotting courses</li>
            <li><strong>Spacecraft Rendezvous:</strong> Docking procedures require precise relative velocity calculations</li>
        </ul>

        <h3>Mechanical Systems</h3>
        <ul>
            <li><strong>Gear Trains:</strong> Relative motion between gears determines transmission ratios</li>
            <li><strong>Cam Mechanisms:</strong> The follower's motion relative to the cam determines the output motion</li>
            <li><strong>Robotic Arms:</strong> End-effector position depends on relative motion of joints</li>
        </ul>

        <h3>Fluid Dynamics</h3>
        <ul>
            <li><strong>Wind Tunnel Testing:</strong> Air velocity relative to the model simulates flight conditions</li>
            <li><strong>Turbomachinery:</strong> Blade velocity relative to fluid determines energy transfer</li>
        </ul>
    </div>

    <div class="content-section">
        <h2>Summary of Key Equations</h2>
        <div class="equation-table">
            <table>
                <thead>
                    <tr>
                        <th>Concept</th>
                        <th>Equation</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Relative Position</td>
                    <td>\(\vec{r}_{B/A} = \vec{r}_B - \vec{r}_A\)</td>
                    <td>Position of B relative to A</td>
                </tr>
                <tr>
                    <td>Relative Velocity</td>
                    <td>\(\vec{v}_{B/A} = \vec{v}_B - \vec{v}_A\)</td>
                    <td>Velocity of B relative to A</td>
                </tr>
                <tr>
                    <td>Reciprocity</td>
                    <td>\(\vec{v}_{B/A} = -\vec{v}_{A/B}\)</td>
                    <td>Relative velocities are opposite</td>
                </tr>
                <tr>
                    <td>Velocity Addition</td>
                    <td>\(\vec{v}_{C/A} = \vec{v}_{C/B} + \vec{v}_{B/A}\)</td>
                    <td>Chain rule for reference frames</td>
                </tr>
                <tr>
                    <td>Component Form</td>
                    <td>\(\vec{v}_{B/A} = (v_{Bx} - v_{Ax})\hat{i} + (v_{By} - v_{Ay})\hat{j}\)</td>
                    <td>2D relative velocity components</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-section">
        <h2>Practice Problems</h2>
        
        <div class="practice-problems">
            <h3>Problem 1: River Crossing</h3>
            <p>A boat can travel at 5 m/s in still water. It needs to cross a river that flows east at 3 m/s. If the river is 100 m wide:</p>
            <ol>
                <li>At what angle should the boat head to travel straight across?</li>
                <li>What will be the boat's speed relative to the ground?</li>
                <li>How long will it take to cross?</li>
            </ol>
            
            <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
            <div id="solution1" class="hidden">
                <p><strong>Solution:</strong></p>
                <p>1) To travel straight across, the boat's velocity component must cancel the river's flow:</p>
                <p>\(v_{boat} \sin\theta = v_{river} = 3\) m/s</p>
                <p>\(\sin\theta = \frac{3}{5} = 0.6\)</p>
                <p>\(\theta = 36.87°\) west of north</p>
                
                <p>2) Ground speed (northward component):</p>
                <p>\(v_{ground} = v_{boat} \cos\theta = 5 \times 0.8 = 4\) m/s</p>
                
                <p>3) Time to cross:</p>
                <p>\(t = \frac{distance}{speed} = \frac{100}{4} = 25\) seconds</p>
            </div>
        </div>
        
        <div class="practice-problems">
            <h3>Problem 2: Aircraft Navigation</h3>
            <p>An aircraft flies at 200 m/s relative to the air. There's a wind blowing from the west at 50 m/s. The pilot wants to fly northeast (45° from north). What heading should the pilot take, and what will be the ground speed?</p>
            
            <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
            <div id="solution2" class="hidden">
                <p><strong>Solution:</strong></p>
                <p>Using vector addition: \(\vec{v}_{ground} = \vec{v}_{air} + \vec{v}_{wind}\)</p>
                
                <p>Let the heading be \(\theta\) from north. We need:</p>
                <p>Ground velocity components:</p>
                <p>\(v_{gx} = v_{ground} \sin(45°)\)</p>
                <p>\(v_{gy} = v_{ground} \cos(45°)\)</p>
                
                <p>Air velocity + wind = ground velocity:</p>
                <p>\(200\sin\theta + 50 = v_{ground} \sin(45°)\)</p>
                <p>\(200\cos\theta + 0 = v_{ground} \cos(45°)\)</p>
                
                <p>Solving: \(\theta = 30.96°\) from north</p>
                <p>Ground speed: \(v_{ground} = 236.6\) m/s</p>
            </div>
        </div>
        
        <div class="practice-problems">
            <h3>Problem 3: Collision Course</h3>
            <p>Two cars approach an intersection. Car A travels north at 15 m/s, whilst Car B travels east at 20 m/s. What is the velocity of Car B relative to Car A? At what angle does Car A's driver see Car B approaching?</p>
            
            <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
            <div id="solution3" class="hidden">
                <p><strong>Solution:</strong></p>
                <p>Relative velocity of B with respect to A:</p>
                <p>\(\vec{v}_{B/A} = \vec{v}_B - \vec{v}_A\)</p>
                <p>\(\vec{v}_{B/A} = 20\hat{i} - 15\hat{j}\) m/s</p>
                
                <p>Magnitude:</p>
                <p>\(|\vec{v}_{B/A}| = \sqrt{20^2 + 15^2} = \sqrt{625} = 25\) m/s</p>
                
                <p>Direction (from Car A's perspective):</p>
                <p>\(\theta = \tan^{-1}\left(\frac{20}{15}\right) = 53.13°\) east of south</p>
                
                <p>From Car A's viewpoint, Car B appears to approach from the southeast at 25 m/s.</p>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Knowledge Check Quiz</h2>
        <div class="quiz-container">
            <div class="quiz-question">
                <h3>QN1: Two cars approach an intersection. Car A travels north at 15 m/s, and Car B travels east at 20 m/s. What is the magnitude of Car B's velocity relative to Car A?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> 5 m/s</label>
                    <label><input type="radio" name="q1" value="b"> 17.5 m/s</label>
                    <label><input type="radio" name="q1" value="c"> 25 m/s</label>
                    <label><input type="radio" name="q1" value="d"> 35 m/s</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>QN2: A boat can travel at 8 m/s in still water. It needs to cross a river flowing at 3 m/s. What is the minimum time required to cross a 120 m wide river?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> 15 s</label>
                    <label><input type="radio" name="q2" value="b"> 17.2 s</label>
                    <label><input type="radio" name="q2" value="c"> 20 s</label>
                    <label><input type="radio" name="q2" value="d"> 40 s</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>QN3: If the velocity of object B relative to A is \(\vec{v}_{B/A} = 10\hat{i} + 5\hat{j}\) m/s, what is \(\vec{v}_{A/B}\)?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> \(10\hat{i} + 5\hat{j}\) m/s</label>
                    <label><input type="radio" name="q3" value="b"> \(-10\hat{i} - 5\hat{j}\) m/s</label>
                    <label><input type="radio" name="q3" value="c"> \(5\hat{i} + 10\hat{j}\) m/s</label>
                    <label><input type="radio" name="q3" value="d"> \(-5\hat{i} - 10\hat{j}\) m/s</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>QN4: An aircraft flies at 250 m/s relative to the air. A wind blows from west to east at 40 m/s. If the pilot wants to fly northeast (45° from north), which statement is correct?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> The aircraft should point exactly northeast</label>
                    <label><input type="radio" name="q4" value="b"> The aircraft should point slightly west of northeast</label>
                    <label><input type="radio" name="q4" value="c"> The ground speed will be exactly 250 m/s</label>
                    <label><input type="radio" name="q4" value="d"> The wind has no effect on the heading</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>QN5: Which equation represents the velocity addition rule for three reference frames (A, B, and ground G)?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> \(\vec{v}_{A/G} = \vec{v}_{B/A} + \vec{v}_{B/G}\)</label>
                    <label><input type="radio" name="q5" value="b"> \(\vec{v}_{B/G} = \vec{v}_{B/A} + \vec{v}_{A/G}\)</label>
                    <label><input type="radio" name="q5" value="c"> \(\vec{v}_{B/A} = \vec{v}_{B/G} - \vec{v}_{A/G}\)</label>
                    <label><input type="radio" name="q5" value="d"> \(\vec{v}_{A/B} = \vec{v}_{A/G} + \vec{v}_{B/G}\)</label>
                </div>
            </div>

            <button id="submit-quiz">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <footer>
        <script src="/assets/common/footer.js"></script>
    </footer>

    <!-- Common JavaScript functions -->
    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

    <script>
        // p5.js sketch for relative motion simulation
        let objectA, objectB;
        let povMode = 'ground'; // 'ground', 'objectA', 'objectB'
        let trailA = [];
        let trailB = [];
        let isPaused = false;
        let scaleFactor = 50; // pixels per metre
        let showGrid = true;
        let showTrails = true;
        
        function setup() {
            let canvas = createCanvas(800, 500);
            canvas.parent('sketch-holder');
            
            // Initialise objects
            resetPositions();
            
            // Setup UI event listeners
            setupControls();
        }
        
        function resetPositions() {
            objectA = {
                pos: createVector(width * 0.3, height * 0.7),
                vel: createVector(2 * cos(radians(45)), -2 * sin(radians(45))),
                colour: color(255, 100, 100)
            };
            
            objectB = {
                pos: createVector(width * 0.7, height * 0.3),
                vel: createVector(3 * cos(radians(135)), -3 * sin(radians(135))),
                colour: color(100, 100, 255)
            };
            
            trailA = [];
            trailB = [];
        }
        
        function draw() {
            background(240);
            
            push();
            // Apply transformation based on POV
            if (povMode === 'objectA') {
                translate(width/2 - objectA.pos.x, height/2 - objectA.pos.y);
            } else if (povMode === 'objectB') {
                translate(width/2 - objectB.pos.x, height/2 - objectB.pos.y);
            }
            
            // Draw grid (if enabled)
            if (showGrid) {
                drawGrid();
            }
            
            // Update positions if not paused
            if (!isPaused) {
                updatePositions();
            }
            
            // Draw trails (if enabled)
            if (showTrails) {
                drawTrails();
            }

            // Draw velocity vectors (below objects)
            drawVelocityVectors();

            // Draw objects
            drawObject(objectA, 'A');
            drawObject(objectB, 'B');
            
            pop();
            
            // Draw velocity diagram (always in screen coordinates)
            drawVelocityDiagram();
            
            // Draw reference frame label
            drawReferenceLabel();
        }
        
        function updatePositions() {
            if (!isPaused) {
                // Save previous positions to detect warps
                let prevPosA = objectA.pos.copy();
                let prevPosB = objectB.pos.copy();

                // Update positions based on velocities
                objectA.pos.add(p5.Vector.mult(objectA.vel, 0.5));
                objectB.pos.add(p5.Vector.mult(objectB.vel, 0.5));

                // Wrap around screen edges
                let warpedA = false;
                let warpedB = false;

                if (objectA.pos.x < 0) { objectA.pos.x = width; warpedA = true; }
                if (objectA.pos.x > width) { objectA.pos.x = 0; warpedA = true; }
                if (objectA.pos.y < 0) { objectA.pos.y = height; warpedA = true; }
                if (objectA.pos.y > height) { objectA.pos.y = 0; warpedA = true; }

                if (objectB.pos.x < 0) { objectB.pos.x = width; warpedB = true; }
                if (objectB.pos.x > width) { objectB.pos.x = 0; warpedB = true; }
                if (objectB.pos.y < 0) { objectB.pos.y = height; warpedB = true; }
                if (objectB.pos.y > height) { objectB.pos.y = 0; warpedB = true; }

                // Add to trails only if no warp occurred
                if (frameCount % 3 === 0) {
                    if (!warpedA) {
                        trailA.push(objectA.pos.copy());
                        // Limit trail length
                        if (trailA.length > 50) trailA.shift();
                    } else {
                        // Clear trail on warp
                        trailA = [];
                    }

                    if (!warpedB) {
                        trailB.push(objectB.pos.copy());
                        // Limit trail length
                        if (trailB.length > 50) trailB.shift();
                    } else {
                        // Clear trail on warp
                        trailB = [];
                    }
                }
            }
        }
        
        function drawGrid() {
            stroke(220);
            strokeWeight(1);
            
            // Draw grid lines
            for (let x = -width; x < width * 2; x += 50) {
                line(x, -height, x, height * 2);
            }
            for (let y = -height; y < height * 2; y += 50) {
                line(-width, y, width * 2, y);
            }
        }
        
        function drawObject(obj, label) {
            push();
            fill(obj.colour);
            noStroke();
            ellipse(obj.pos.x, obj.pos.y, 30, 30);
            
            fill(255);
            textAlign(CENTER, CENTER);
            textSize(14);
            text(label, obj.pos.x, obj.pos.y);
            pop();
        }
        
        function drawTrails() {
            noFill();
            strokeWeight(2);
            
            // Draw trail for A
            stroke(255, 100, 100, 100);
            beginShape();
            for (let p of trailA) {
                vertex(p.x, p.y);
            }
            endShape();
            
            // Draw trail for B
            stroke(100, 100, 255, 100);
            beginShape();
            for (let p of trailB) {
                vertex(p.x, p.y);
            }
            endShape();
        }
        
        function drawVelocityVectors() {
            strokeWeight(3);
            
            // Adjust velocities based on POV
            let velA = objectA.vel.copy();
            let velB = objectB.vel.copy();
            
            if (povMode === 'objectA') {
                velB.sub(objectA.vel);
                velA = createVector(0, 0);
            } else if (povMode === 'objectB') {
                velA.sub(objectB.vel);
                velB = createVector(0, 0);
            }
            
            // Draw velocity vector for A
            stroke(255, 100, 100);
            drawArrow(objectA.pos, p5.Vector.mult(velA, scaleFactor));
            
            // Draw velocity vector for B
            stroke(100, 100, 255);
            drawArrow(objectB.pos, p5.Vector.mult(velB, scaleFactor));
            
            // Draw relative velocity vector
            if (povMode === 'objectA') {
                stroke(150, 50, 255);
                drawArrow(objectB.pos, p5.Vector.mult(velB, scaleFactor));
            } else if (povMode === 'objectB') {
                stroke(255, 50, 150);
                drawArrow(objectA.pos, p5.Vector.mult(velA, scaleFactor));
            }
        }
        
        function drawArrow(base, vec) {
            push();
            // Get current stroke color for both stroke and fill
            let currentStroke = drawingContext.strokeStyle;
            fill(currentStroke);

            translate(base.x, base.y);
            line(0, 0, vec.x, vec.y);

            // Only draw arrowhead if vector is significant (magnitude > 5 pixels)
            let magnitude = sqrt(vec.x * vec.x + vec.y * vec.y);
            if (magnitude > 5) {
                // Arrowhead
                let angle = atan2(vec.y, vec.x);
                translate(vec.x, vec.y);
                rotate(angle);
                let arrowSize = 7;
                triangle(0, 0, -arrowSize, -arrowSize/2, -arrowSize, arrowSize/2);
            }
            pop();
        }
        
        function drawVelocityDiagram() {
            push();
            // Position in top-right corner
            translate(width - 150, 100);
            
            // Background
            fill(255, 255, 255, 200);
            stroke(200);
            strokeWeight(1);
            rect(-70, -70, 140, 140);
            
            // Title
            fill(0);
            noStroke();
            textAlign(CENTER);
            textSize(12);
            text('Velocity Diagram', 0, -55);
            
            // Scale factor for diagram
            let diagScale = 15;
            
            // Adjust velocities based on POV
            let velA = objectA.vel.copy();
            let velB = objectB.vel.copy();
            
            if (povMode === 'objectA') {
                velB.sub(objectA.vel);
                velA = createVector(0, 0);
            } else if (povMode === 'objectB') {
                velA.sub(objectB.vel);
                velB = createVector(0, 0);
            }
            
            // Draw axes
            stroke(180);
            strokeWeight(1);
            line(-60, 0, 60, 0);
            line(0, -60, 0, 60);
            
            // Draw velocity vectors
            strokeWeight(2);
            stroke(255, 100, 100);
            drawArrow(createVector(0, 0), p5.Vector.mult(velA, diagScale));
            
            stroke(100, 100, 255);
            drawArrow(createVector(0, 0), p5.Vector.mult(velB, diagScale));
            
            // Labels
            textSize(10);
            stroke(255,100,100);
            fill(255, 100, 100);
            text('vA', velA.x * diagScale + 10, velA.y * diagScale);
            stroke(100, 100, 255);
            fill(100, 100, 255);
            text('vB', velB.x * diagScale + 10, velB.y * diagScale);
            
            pop();
        }
        
        function drawReferenceLabel() {
            push();
            fill(0);
            textAlign(LEFT);
            textSize(14);
            let label = 'Reference Frame: ';
            if (povMode === 'ground') {
                label += 'Stationary Observer';
            } else if (povMode === 'objectA') {
                label += 'Object A';
            } else {
                label += 'Object B';
            }
            text(label, 10, 20);
            pop();
        }
        
        function setupControls() {
            // POV buttons
            document.getElementById('pov-ground').addEventListener('click', () => {
                povMode = 'ground';
                updatePOVButtons();
            });
            
            document.getElementById('pov-object1').addEventListener('click', () => {
                povMode = 'objectA';
                updatePOVButtons();
            });
            
            document.getElementById('pov-object2').addEventListener('click', () => {
                povMode = 'objectB';
                updatePOVButtons();
            });
            
            // Velocity controls
            document.getElementById('speed1').addEventListener('input', updateVelocities);
            document.getElementById('angle1').addEventListener('input', updateVelocities);
            document.getElementById('speed2').addEventListener('input', updateVelocities);
            document.getElementById('angle2').addEventListener('input', updateVelocities);
            
            // Reset and pause buttons
            document.getElementById('reset-button').addEventListener('click', resetPositions);
            document.getElementById('pause-button').addEventListener('click', () => {
                isPaused = !isPaused;
            });

            // Toggle buttons
            document.getElementById('toggle-grid').addEventListener('click', () => {
                showGrid = !showGrid;
            });
            document.getElementById('toggle-trails').addEventListener('click', () => {
                showTrails = !showTrails;
            });
            
            // Initial update
            updateVelocities();
        }
        
        function updatePOVButtons() {
            document.querySelectorAll('.pov-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Update button active states
            if (povMode === 'ground') {
                document.getElementById('pov-ground').classList.add('active');
            } else if (povMode === 'objectA') {
                document.getElementById('pov-object1').classList.add('active');
            } else {
                document.getElementById('pov-object2').classList.add('active');
            }

            // Update velocity info card visibility
            const cardAbsolute = document.getElementById('card-absolute');
            const cardRelativeBA = document.getElementById('card-relative-ba');
            const cardRelativeAB = document.getElementById('card-relative-ab');

            if (povMode === 'ground') {
                cardAbsolute.classList.remove('hidden');
                cardRelativeBA.classList.add('hidden');
                cardRelativeAB.classList.add('hidden');
            } else if (povMode === 'objectA') {
                cardAbsolute.classList.remove('hidden');
                cardRelativeBA.classList.remove('hidden');
                cardRelativeAB.classList.add('hidden');
            } else if (povMode === 'objectB') {
                cardAbsolute.classList.remove('hidden');
                cardRelativeAB.classList.remove('hidden');
                cardRelativeBA.classList.add('hidden');
            }
        }
        
        function updateVelocities() {
            // Get values from controls
            let speed1 = parseFloat(document.getElementById('speed1').value);
            let angle1 = parseFloat(document.getElementById('angle1').value);
            let speed2 = parseFloat(document.getElementById('speed2').value);
            let angle2 = parseFloat(document.getElementById('angle2').value);
            
            // Update velocity vectors
            objectA.vel = createVector(
                speed1 * cos(radians(angle1)),
                -speed1 * sin(radians(angle1))
            );
            
            objectB.vel = createVector(
                speed2 * cos(radians(angle2)),
                -speed2 * sin(radians(angle2))
            );
            
            // Update display values
            document.getElementById('speed1-value').textContent = speed1.toFixed(1) + ' m/s';
            document.getElementById('angle1-value').textContent = angle1 + '°';
            document.getElementById('speed2-value').textContent = speed2.toFixed(1) + ' m/s';
            document.getElementById('angle2-value').textContent = angle2 + '°';
            
            // Update velocity info cards
            updateVelocityInfo(speed1, angle1, speed2, angle2);
        }
        
        function updateVelocityInfo(speed1, angle1, speed2, angle2) {
            // Object A
            let vAx = speed1 * cos(radians(angle1));
            let vAy = speed1 * sin(radians(angle1));
            document.getElementById('vel-a').textContent = `${speed1.toFixed(1)} m/s @ ${angle1}°`;

            // Object B
            let vBx = speed2 * cos(radians(angle2));
            let vBy = speed2 * sin(radians(angle2));
            document.getElementById('vel-b').textContent = `${speed2.toFixed(1)} m/s @ ${angle2}°`;

            // B relative to A
            let vBAx = vBx - vAx;
            let vBAy = vBy - vAy;
            let vBAMag = sqrt(vBAx * vBAx + vBAy * vBAy);
            let vBAAngle = degrees(atan2(vBAy, vBAx));
            if (vBAAngle < 0) vBAAngle += 360;
            document.getElementById('vel-rel-ba').textContent = `${vBAMag.toFixed(2)} m/s @ ${Math.round(vBAAngle)}°`;

            // A relative to B
            let vABx = vAx - vBx;
            let vABy = vAy - vBy;
            let vABMag = sqrt(vABx * vABx + vABy * vABy);
            let vABAngle = degrees(atan2(vABy, vABx));
            if (vABAngle < 0) vABAngle += 360;
            document.getElementById('vel-rel-ab').textContent = `${vABMag.toFixed(2)} m/s @ ${Math.round(vABAngle)}°`;
        }

        // Quiz functionality
        document.addEventListener('DOMContentLoaded', function() {
            const quizBtn = document.getElementById('submit-quiz');
            if (quizBtn) {
                quizBtn.addEventListener('click', function() {
                    const answers = {
                        q1: 'c', // 25 m/s (sqrt(15^2 + 20^2))
                        q2: 'a', // 15 s (120/8, heading straight across)
                        q3: 'b', // negative of both components
                        q4: 'b', // must compensate for wind from the west
                        q5: 'b'  // velocity addition formula
                    };

                    let score = 0;
                    let totalQuestions = Object.keys(answers).length;
                    let resultsHTML = '<h3>Quiz Results:</h3>';

                    for (let question in answers) {
                        const selectedOption = document.querySelector(`input[name="${question}"]:checked`);
                        const correctAnswer = answers[question];

                        if (selectedOption) {
                            if (selectedOption.value === correctAnswer) {
                                score++;
                                resultsHTML += `<p style="color: #28a745; font-weight: bold;">${question.toUpperCase()}: Correct! ✓</p>`;
                            } else {
                                resultsHTML += `<p style="color: #dc3545; font-weight: bold;">${question.toUpperCase()}: Incorrect ✗</p>`;
                            }
                        } else {
                            resultsHTML += `<p style="color: #333;">${question.toUpperCase()}: Not answered</p>`;
                        }
                    }

                    const percentage = ((score / totalQuestions) * 100).toFixed(0);
                    resultsHTML = `<p style="font-size: 1.2em; font-weight: bold;">You scored ${score} out of ${totalQuestions} (${percentage}%)</p>` + resultsHTML;

                    const resultsDiv = document.getElementById('quiz-results');
                    resultsDiv.innerHTML = resultsHTML;
                    resultsDiv.classList.remove('hidden');
                });
            }
        });

        // toggleSolution function now loaded from /assets/common/problems.js
    </script>
</body>
</html>