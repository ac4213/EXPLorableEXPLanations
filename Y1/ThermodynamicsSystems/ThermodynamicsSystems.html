<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermodynamic Systems - Interactive Lecture</title>

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/problems.css">
    <link rel="stylesheet" href="/assets/css/quizzes.css">
    <link rel="stylesheet" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

    <style>
        .system-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .system-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .system-card h4 {
            margin-top: 0;
            color: var(--primary-color);
        }
        .transfer-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 5px;
        }
        .yes-transfer {
            background-color: #4CAF50;
        }
        .no-transfer {
            background-color: #F44336;
        }
    </style>
</head>

<body>
    <header>
        <h1>Thermodynamic Systems</h1>
        <p class="subtitle">Closed, Open, and Isolated Systems</p>
    </header>

    <!-- Section 1: Theory -->
    <div class="content-section">
        <h2>Understanding Thermodynamic Systems</h2>
        <div class="key-point">
            <p><strong>Key Insight:</strong> Thermodynamic systems are classified based on their ability to exchange mass and energy with their surroundings. Understanding these classifications is fundamental to analyzing real-world engineering systems.</p>
        </div>

        <p>A <strong>thermodynamic system</strong> is a quantity of matter or a region in space chosen for study. Everything external to the system is called the <strong>surroundings</strong>, and the real or imaginary surface that separates them is the <strong>boundary</strong>.</p>

        <h3>Types of Thermodynamic Systems</h3>

        <div class="system-comparison">
            <div class="system-card">
                <h4>1. Open System (Control Volume)</h4>
                <p><strong>Mass Transfer:</strong> <span class="transfer-icon yes-transfer"></span> YES</p>
                <p><strong>Energy Transfer:</strong> <span class="transfer-icon yes-transfer"></span> YES</p>
                <p>Both mass and energy can cross the system boundary.</p>
                <p><strong>Examples:</strong> Turbines, compressors, pumps, heat exchangers, boilers</p>
            </div>

            <div class="system-card">
                <h4>2. Closed System (Control Mass)</h4>
                <p><strong>Mass Transfer:</strong> <span class="transfer-icon no-transfer"></span> NO</p>
                <p><strong>Energy Transfer:</strong> <span class="transfer-icon yes-transfer"></span> YES</p>
                <p>Fixed mass; energy can cross the boundary as heat or work.</p>
                <p><strong>Examples:</strong> Piston-cylinder, pressure cooker, sealed can being heated</p>
            </div>

            <div class="system-card">
                <h4>3. Isolated System</h4>
                <p><strong>Mass Transfer:</strong> <span class="transfer-icon no-transfer"></span> NO</p>
                <p><strong>Energy Transfer:</strong> <span class="transfer-icon no-transfer"></span> NO</p>
                <p>Neither mass nor energy can cross the boundary.</p>
                <p><strong>Examples:</strong> Insulated rigid tank, thermos bottle (ideal), the universe</p>
            </div>
        </div>

        <h3>Mathematical Representations</h3>

        <div class="equation-box">
            <p><strong>Conservation of Mass (General):</strong></p>
            <p>\[\frac{dm_{system}}{dt} = \sum \dot{m}_{in} - \sum \dot{m}_{out}\]</p>
            <p>For <strong>closed systems:</strong> \(\dot{m}_{in} = \dot{m}_{out} = 0\), so \(m_{system} = \text{constant}\)</p>
            <p>For <strong>open systems (steady flow):</strong> \(\sum \dot{m}_{in} = \sum \dot{m}_{out}\)</p>
        </div>

        <div class="equation-box">
            <p><strong>First Law of Thermodynamics:</strong></p>
            <p><strong>Closed Systems:</strong></p>
            <p>\[\Delta E_{system} = Q - W\]</p>
            <p>Where: \(Q\) = heat transfer, \(W\) = work transfer, \(\Delta E\) = change in total energy</p>
            <br>
            <p><strong>Open Systems (Steady Flow):</strong></p>
            <p>\[\dot{Q} - \dot{W} = \sum \dot{m}_{out}\left(h + \frac{V^2}{2} + gz\right)_{out} - \sum \dot{m}_{in}\left(h + \frac{V^2}{2} + gz\right)_{in}\]</p>
            <p>Where: \(h\) = specific enthalpy, \(V\) = velocity, \(z\) = elevation</p>
        </div>

        <div class="equation-box">
            <p><strong>Second Law (Entropy):</strong></p>
            <p><strong>Isolated System:</strong> \(\Delta S_{isolated} \geq 0\) (entropy never decreases)</p>
            <p><strong>Closed System:</strong> \(\Delta S_{system} = \int \frac{\delta Q}{T} + S_{gen}\), where \(S_{gen} \geq 0\)</p>
        </div>

        <h3>System Boundary Characteristics</h3>
        <ul>
            <li><strong>Fixed boundary:</strong> Does not move (rigid walls) - no boundary work</li>
            <li><strong>Movable boundary:</strong> Can expand/contract (piston) - boundary work occurs</li>
            <li><strong>Permeable boundary:</strong> Allows mass transfer (open systems)</li>
            <li><strong>Impermeable boundary:</strong> No mass transfer (closed/isolated)</li>
            <li><strong>Diathermic boundary:</strong> Allows heat transfer</li>
            <li><strong>Adiabatic boundary:</strong> No heat transfer (insulated)</li>
        </ul>
    </div>

    <!-- Section 2: Interactive Simulation -->
    <div class="simulation-container">
        <h2>Interactive System Simulation</h2>
        <p>Observe how mass and energy flow in different thermodynamic systems. Use the controls to switch between system types and observe their behavior.</p>

        <div class="controls-grid">
            <div class="slider-container">
                <label for="heat-input">Heat Input Rate: <span id="heat-input-value" class="value-display">50</span> kW</label>
                <input type="range" id="heat-input" min="0" max="100" value="50" step="5" class="slider">
            </div>

            <div class="slider-container">
                <label for="mass-flow">Mass Flow Rate: <span id="mass-flow-value" class="value-display">2.0</span> kg/s</label>
                <input type="range" id="mass-flow" min="0" max="5" value="2" step="0.1" class="slider">
            </div>

            <div class="slider-container">
                <label for="work-output">Work Output Rate: <span id="work-output-value" class="value-display">30</span> kW</label>
                <input type="range" id="work-output" min="0" max="100" value="30" step="5" class="slider">
            </div>
        </div>

        <div class="type-selector">
            <button id="btn-open" class="control-button">Open System</button>
            <button id="btn-closed" class="control-button">Closed System</button>
            <button id="btn-isolated" class="control-button">Isolated System</button>
        </div>

        <div id="sketch-holder"></div>
    </div>

    <!-- Section 3: Engineering Applications -->
    <div class="content-section">
        <h2>Engineering Applications</h2>

        <h3>Open Systems (Control Volumes)</h3>
        <ul>
            <li><strong>Gas Turbine Engines:</strong> Air enters, combustion occurs, hot gases exit. Mass flow is continuous, energy is extracted as shaft work. Essential for aircraft propulsion and power generation.</li>

            <li><strong>Heat Exchangers:</strong> Two fluid streams exchange thermal energy without mixing. Both streams flow through the control volume, making it an open system. Used in HVAC, chemical plants, and power cycles.</li>

            <li><strong>Steam Turbines:</strong> High-pressure steam enters, expands through blades (producing work), and exits at lower pressure. Critical component in Rankine cycles for electricity generation.</li>

            <li><strong>Compressors and Pumps:</strong> Work input increases fluid pressure as it flows through. Open system analysis determines power requirements and efficiency.</li>
        </ul>

        <h3>Closed Systems (Control Mass)</h3>
        <ul>
            <li><strong>Internal Combustion Engines:</strong> During the compression and power strokes, the combustion chamber acts as a closed system with fixed mass undergoing heat addition and work extraction.</li>

            <li><strong>Pressure Vessels:</strong> Rigid containers storing gases or liquids at elevated pressure. Energy can be added/removed via heat transfer, but mass remains constant.</li>

            <li><strong>Piston-Cylinder Assemblies:</strong> Classic example where gas is compressed or expanded. Used to teach fundamental thermodynamic processes (isothermal, adiabatic, etc.).</li>

            <li><strong>Batch Reactors:</strong> Chemical reactions occur in a closed vessel. Reactants are loaded, reaction proceeds, and products are removed only after completion.</li>
        </ul>

        <h3>Isolated Systems</h3>
        <ul>
            <li><strong>Calorimetry:</strong> Insulated calorimeters approximate isolated systems to measure heat of reaction or specific heat capacity without external energy exchange.</li>

            <li><strong>Adiabatic Mixing:</strong> Two fluids mix in an insulated, rigid container. No heat or mass crosses the boundary, making it effectively isolated. Used to find equilibrium temperatures.</li>

            <li><strong>The Universe:</strong> The ultimate isolated system. No energy or mass can enter or leave. The second law dictates that universal entropy always increases.</li>

            <li><strong>Theoretical Analysis:</strong> Many problems assume isolated conditions to simplify analysis and understand fundamental limits (e.g., isentropic efficiency, Carnot cycle bounds).</li>
        </ul>
    </div>

    <!-- Section 4: Summary of Key Equations -->
    <div class="content-section">
        <h2>Summary of Key Equations</h2>

        <table class="equation-table">
            <thead>
                <tr>
                    <th>System Type</th>
                    <th>Conservation Law</th>
                    <th>Equation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="2"><strong>Open System</strong></td>
                    <td>Mass Conservation</td>
                    <td>\(\frac{dm}{dt} = \sum \dot{m}_{in} - \sum \dot{m}_{out}\)</td>
                </tr>
                <tr>
                    <td>Energy Conservation</td>
                    <td>\(\dot{Q} - \dot{W} = \sum \dot{m}_{out}h_{out} - \sum \dot{m}_{in}h_{in} + \Delta KE + \Delta PE\)</td>
                </tr>
                <tr>
                    <td rowspan="2"><strong>Closed System</strong></td>
                    <td>Mass Conservation</td>
                    <td>\(m = \text{constant}\)</td>
                </tr>
                <tr>
                    <td>Energy Conservation (1st Law)</td>
                    <td>\(\Delta E = Q - W\) or \(\Delta U = Q - W\) (neglecting KE, PE)</td>
                </tr>
                <tr>
                    <td rowspan="2"><strong>Isolated System</strong></td>
                    <td>Mass + Energy</td>
                    <td>\(m = \text{constant}, \quad E = \text{constant}\)</td>
                </tr>
                <tr>
                    <td>Entropy (2nd Law)</td>
                    <td>\(\Delta S_{isolated} \geq 0\)</td>
                </tr>
                <tr>
                    <td><strong>General</strong></td>
                    <td>Total Energy</td>
                    <td>\(E = U + KE + PE = U + \frac{1}{2}mV^2 + mgz\)</td>
                </tr>
                <tr>
                    <td><strong>Steady Flow</strong></td>
                    <td>Continuity</td>
                    <td>\(\sum \dot{m}_{in} = \sum \dot{m}_{out}\) and \(\frac{dm_{CV}}{dt} = 0\)</td>
                </tr>
            </tbody>
        </table>

        <div class="equation-box">
            <p><strong>Work and Heat Sign Conventions:</strong></p>
            <ul>
                <li><strong>Heat IN to system:</strong> \(Q > 0\) (positive)</li>
                <li><strong>Heat OUT of system:</strong> \(Q < 0\) (negative)</li>
                <li><strong>Work done BY system:</strong> \(W > 0\) (positive) - expansion</li>
                <li><strong>Work done ON system:</strong> \(W < 0\) (negative) - compression</li>
            </ul>
        </div>
    </div>

    <!-- Section 5: Practice Problems -->
    <div class="content-section">
        <h2>Practice Problems</h2>

        <div class="practice-problems">
            <h3>Problem 1: Closed System Analysis</h3>
            <p>A piston-cylinder device contains 0.5 kg of air initially at 100 kPa and 27°C. The air is compressed in a reversible adiabatic process until the pressure reaches 500 kPa. If \(c_v = 0.718\) kJ/(kg·K) and \(k = 1.4\), calculate the final temperature and the work done on the air.</p>

            <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
            <div id="solution1" class="hidden">
                <p><strong>Solution:</strong></p>
                <p><strong>Given:</strong></p>
                <ul>
                    <li>Mass: \(m = 0.5\) kg</li>
                    <li>Initial: \(P_1 = 100\) kPa, \(T_1 = 27°C = 300\) K</li>
                    <li>Final: \(P_2 = 500\) kPa</li>
                    <li>\(c_v = 0.718\) kJ/(kg·K), \(k = 1.4\)</li>
                    <li>Process: Reversible adiabatic (isentropic)</li>
                </ul>

                <p><strong>Step 1:</strong> For isentropic process of ideal gas:</p>
                <p>\[\frac{T_2}{T_1} = \left(\frac{P_2}{P_1}\right)^{\frac{k-1}{k}} = \left(\frac{500}{100}\right)^{\frac{1.4-1}{1.4}} = (5)^{0.286} = 1.584\]</p>

                <p><strong>Step 2:</strong> Calculate final temperature</p>
                <p>\[T_2 = T_1 \times 1.584 = 300 \times 1.584 = 475.2 \text{ K} = 202.2°C\]</p>

                <p><strong>Step 3:</strong> Calculate work (closed system, adiabatic)</p>
                <p>For adiabatic process: \(Q = 0\), so from first law: \(W = -\Delta U\)</p>
                <p>\[W = -m c_v (T_2 - T_1) = -0.5 \times 0.718 \times (475.2 - 300)\]</p>
                <p>\[W = -0.5 \times 0.718 \times 175.2 = -62.9 \text{ kJ}\]</p>

                <p><strong>Answers:</strong></p>
                <p>Final temperature: \(T_2 = 475.2\) K (202.2°C)</p>
                <p>Work: \(W = -62.9\) kJ (negative indicates work is done ON the air)</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 2: Open System (Steady Flow)</h3>
            <p>Steam enters a turbine at 3 MPa, 400°C with a velocity of 50 m/s and exits at 50 kPa, 100°C with a velocity of 200 m/s. The mass flow rate is 5 kg/s. Heat loss from the turbine is 20 kW. Calculate the power output. Use: \(h_1 = 3231\) kJ/kg (inlet), \(h_2 = 2676\) kJ/kg (exit).</p>

            <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
            <div id="solution2" class="hidden">
                <p><strong>Solution:</strong></p>
                <p><strong>Given:</strong></p>
                <ul>
                    <li>Inlet: \(P_1 = 3\) MPa, \(T_1 = 400°C\), \(V_1 = 50\) m/s, \(h_1 = 3231\) kJ/kg</li>
                    <li>Exit: \(P_2 = 50\) kPa, \(T_2 = 100°C\), \(V_2 = 200\) m/s, \(h_2 = 2676\) kJ/kg</li>
                    <li>Mass flow: \(\dot{m} = 5\) kg/s</li>
                    <li>Heat loss: \(\dot{Q} = -20\) kW (negative for heat out)</li>
                </ul>

                <p><strong>Step 1:</strong> Apply steady flow energy equation</p>
                <p>\[\dot{Q} - \dot{W} = \dot{m}\left[\left(h_2 - h_1\right) + \frac{V_2^2 - V_1^2}{2} + g(z_2 - z_1)\right]\]</p>
                <p>Neglecting potential energy change (\(\Delta PE \approx 0\))</p>

                <p><strong>Step 2:</strong> Calculate kinetic energy change</p>
                <p>\[\Delta KE = \frac{V_2^2 - V_1^2}{2} = \frac{200^2 - 50^2}{2} = \frac{40000 - 2500}{2} = 18750 \text{ J/kg} = 18.75 \text{ kJ/kg}\]</p>

                <p><strong>Step 3:</strong> Calculate enthalpy change</p>
                <p>\[\Delta h = h_2 - h_1 = 2676 - 3231 = -555 \text{ kJ/kg}\]</p>

                <p><strong>Step 4:</strong> Calculate power output</p>
                <p>\[\dot{W} = \dot{Q} - \dot{m}(\Delta h + \Delta KE)\]</p>
                <p>\[\dot{W} = -20 - 5(-555 + 18.75) = -20 - 5(-536.25)\]</p>
                <p>\[\dot{W} = -20 + 2681.25 = 2661.25 \text{ kW}\]</p>

                <p><strong>Answer:</strong> Power output = 2661 kW or 2.66 MW</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 3: Isolated System (Mixing)</h3>
            <p>An insulated rigid tank is divided into two compartments. One contains 2 kg of water at 80°C, and the other contains 3 kg of water at 20°C. The partition is removed and the waters mix. Assuming constant specific heat \(c_p = 4.18\) kJ/(kg·K), find the final equilibrium temperature.</p>

            <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
            <div id="solution3" class="hidden">
                <p><strong>Solution:</strong></p>
                <p><strong>Given:</strong></p>
                <ul>
                    <li>Hot water: \(m_h = 2\) kg, \(T_h = 80°C = 353\) K</li>
                    <li>Cold water: \(m_c = 3\) kg, \(T_c = 20°C = 293\) K</li>
                    <li>Specific heat: \(c_p = 4.18\) kJ/(kg·K)</li>
                    <li>System: Isolated (rigid, insulated)</li>
                </ul>

                <p><strong>Step 1:</strong> Apply energy conservation</p>
                <p>For isolated system: \(\Delta E_{total} = 0\)</p>
                <p>Energy lost by hot water = Energy gained by cold water</p>
                <p>\[m_h c_p (T_h - T_f) = m_c c_p (T_f - T_c)\]</p>

                <p><strong>Step 2:</strong> Solve for final temperature</p>
                <p>\[m_h (T_h - T_f) = m_c (T_f - T_c)\]</p>
                <p>\[2(80 - T_f) = 3(T_f - 20)\]</p>
                <p>\[160 - 2T_f = 3T_f - 60\]</p>
                <p>\[160 + 60 = 3T_f + 2T_f\]</p>
                <p>\[220 = 5T_f\]</p>
                <p>\[T_f = 44°C\]</p>

                <p><strong>Step 3:</strong> Verify energy balance</p>
                <p>Energy lost by hot: \(Q_h = 2 \times 4.18 \times (80-44) = 300.96\) kJ</p>
                <p>Energy gained by cold: \(Q_c = 3 \times 4.18 \times (44-20) = 300.96\) kJ ✓</p>

                <p><strong>Answer:</strong> Final temperature = 44°C</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 4: System Classification</h3>
            <p>Classify each of the following as an open, closed, or isolated system:</p>
            <p>(a) A cup of hot coffee cooling on a table</p>
            <p>(b) A steam turbine in a power plant</p>
            <p>(c) A sealed, insulated thermos bottle</p>
            <p>(d) An electric water heater with flowing water</p>

            <p class="toggle-section" onclick="toggleSolution('solution4')">Show Solution</p>
            <div id="solution4" class="hidden">
                <p><strong>Solution:</strong></p>

                <p><strong>(a) Cup of hot coffee:</strong> <strong>Closed System</strong></p>
                <p>Mass of coffee remains constant (no flow in/out), but heat is lost to surroundings (energy crosses boundary).</p>

                <p><strong>(b) Steam turbine:</strong> <strong>Open System</strong></p>
                <p>Steam continuously flows in and out (mass crosses boundary), and energy is transferred as heat loss and shaft work.</p>

                <p><strong>(c) Sealed, insulated thermos:</strong> <strong>Isolated System (approximately)</strong></p>
                <p>Sealed prevents mass transfer, insulation minimizes heat transfer. In reality, small heat leak makes it nearly isolated but not perfectly.</p>

                <p><strong>(d) Electric water heater (flowing):</strong> <strong>Open System</strong></p>
                <p>Water flows in (cold) and out (hot), so mass crosses boundary. Electrical energy enters as work/heat.</p>

                <p><strong>Key Principle:</strong> Always check for both mass and energy transfer across the boundary!</p>
            </div>
        </div>
    </div>

    <!-- Section 6: Knowledge Check Quiz -->
    <div class="content-section">
        <h2>Knowledge Check Quiz</h2>
        <div class="quiz-container">
            <div class="quiz-question">
                <h3>Question 1: Which system allows both mass and energy to cross its boundary?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> a) Closed system</label>
                    <label><input type="radio" name="q1" value="b"> b) Open system</label>
                    <label><input type="radio" name="q1" value="c"> c) Isolated system</label>
                    <label><input type="radio" name="q1" value="d"> d) Adiabatic system</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 2: In a closed system undergoing a process, which statement is true?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> a) Mass can flow in but not out</label>
                    <label><input type="radio" name="q2" value="b"> b) Mass remains constant</label>
                    <label><input type="radio" name="q2" value="c"> c) Energy cannot cross the boundary</label>
                    <label><input type="radio" name="q2" value="d"> d) Both mass and energy are fixed</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 3: An isolated system is characterized by:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> a) Fixed mass only</label>
                    <label><input type="radio" name="q3" value="b"> b) Fixed energy only</label>
                    <label><input type="radio" name="q3" value="c"> c) No mass or energy transfer across boundary</label>
                    <label><input type="radio" name="q3" value="d"> d) Only heat transfer is allowed</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 4: A gas turbine engine is best analyzed as:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> a) A closed system</label>
                    <label><input type="radio" name="q4" value="b"> b) An open system</label>
                    <label><input type="radio" name="q4" value="c"> c) An isolated system</label>
                    <label><input type="radio" name="q4" value="d"> d) An adiabatic system</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 5: For a steady-flow open system, which is true?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> a) Mass in the control volume changes with time</label>
                    <label><input type="radio" name="q5" value="b"> b) Mass flow rate in equals mass flow rate out</label>
                    <label><input type="radio" name="q5" value="c"> c) No energy transfer occurs</label>
                    <label><input type="radio" name="q5" value="d"> d) Work must be zero</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 6: The first law for a closed system is expressed as:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q6" value="a"> a) \(\Delta E = Q + W\)</label>
                    <label><input type="radio" name="q6" value="b"> b) \(\Delta E = Q - W\)</label>
                    <label><input type="radio" name="q6" value="c"> c) \(\Delta E = 0\)</label>
                    <label><input type="radio" name="q6" value="d"> d) \(Q = W\)</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 7: A piston-cylinder device with gas being compressed is:</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q7" value="a"> a) An open system</label>
                    <label><input type="radio" name="q7" value="b"> b) A closed system</label>
                    <label><input type="radio" name="q7" value="c"> c) An isolated system</label>
                    <label><input type="radio" name="q7" value="d"> d) Not a thermodynamic system</label>
                </div>
            </div>

            <button id="submit-quiz" class="control-button">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <footer>
        <script src="/assets/common/footer.js"></script>
    </footer>

    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

    <script>
        // System Simulation
        let sketch = new p5(function(p) {
            let systemType = 'open'; // 'open', 'closed', 'isolated'
            let heatInput = 50; // kW
            let massFlow = 2; // kg/s
            let workOutput = 30; // kW

            let particles = [];
            let systemEnergy = 100;
            let systemMass = 10;
            let time = 0;

            // Info box data
            let statusTitle = '';
            let massTransfer = '';
            let energyTransfer = '';
            let statusLine1 = '';
            let statusLine2 = '';

            p.setup = function() {
                let canvas = p.createCanvas(Math.min(900, p.windowWidth - 40), 500);
                setupControls();
                initializeParticles();
            };

            p.draw = function() {
                p.background(240);
                time += 0.016; // approximately 60 fps

                // Update system based on type
                updateSystem();

                // Draw system boundary
                drawSystemBoundary();

                // Draw particles
                updateAndDrawParticles();

                // Draw energy and mass indicators
                drawIndicators();

                // Draw arrows for transfers
                drawTransferArrows();

                // Draw info box
                drawInfobox();
            };

            function setupControls() {
                document.getElementById('heat-input').addEventListener('input', function() {
                    heatInput = parseFloat(this.value);
                    document.getElementById('heat-input-value').textContent = heatInput;
                });

                document.getElementById('mass-flow').addEventListener('input', function() {
                    massFlow = parseFloat(this.value);
                    document.getElementById('mass-flow-value').textContent = massFlow.toFixed(1);
                });

                document.getElementById('work-output').addEventListener('input', function() {
                    workOutput = parseFloat(this.value);
                    document.getElementById('work-output-value').textContent = workOutput;
                });

                document.getElementById('btn-open').addEventListener('click', function() {
                    systemType = 'open';
                    updateSystemStatus();
                });

                document.getElementById('btn-closed').addEventListener('click', function() {
                    systemType = 'closed';
                    updateSystemStatus();
                });

                document.getElementById('btn-isolated').addEventListener('click', function() {
                    systemType = 'isolated';
                    updateSystemStatus();
                });
            }

            function initializeParticles() {
                particles = [];
                for (let i = 0; i < 30; i++) {
                    particles.push({
                        x: p.random(200, 700),
                        y: p.random(150, 350),
                        vx: p.random(-1, 1),
                        vy: p.random(-1, 1),
                        size: p.random(4, 8),
                        color: [p.random(100, 255), p.random(100, 200), p.random(100, 255)]
                    });
                }
            }

            function updateSystem() {
                const dt = 0.016; // time step in seconds

                if (systemType === 'open') {
                    // Mass and energy can change
                    systemMass += 0; // simplified: steady flow
                    systemEnergy += (heatInput - workOutput) * dt;

                    // Add/remove particles to simulate flow
                    if (p.frameCount % 20 === 0 && particles.length < 40) {
                        particles.push({
                            x: 150,
                            y: 250,
                            vx: 2,
                            vy: p.random(-0.5, 0.5),
                            size: 6,
                            color: [100, 150, 255]
                        });
                    }
                    // Remove particles that exit
                    particles = particles.filter(part => part.x < 800);

                } else if (systemType === 'closed') {
                    // Only energy changes, mass fixed
                    systemEnergy += (heatInput - workOutput) * dt;
                    systemMass = 10; // constant

                    // Keep particles inside
                    particles = particles.filter(part =>
                        part.x > 200 && part.x < 700 && part.y > 150 && part.y < 350
                    );

                } else { // isolated
                    // Neither mass nor energy changes
                    systemMass = 10;
                    systemEnergy = 100;

                    // Keep particles inside, no external influence
                    particles = particles.filter(part =>
                        part.x > 200 && part.x < 700 && part.y > 150 && part.y < 350
                    );
                }

                // Clamp energy
                systemEnergy = p.constrain(systemEnergy, 0, 200);
            }

            function drawSystemBoundary() {
                // Draw system box
                if (systemType === 'isolated') {
                    p.stroke(100);
                    p.strokeWeight(8);
                    p.fill(230, 230, 250, 100);
                } else if (systemType === 'closed') {
                    p.stroke(0, 100, 200);
                    p.strokeWeight(4);
                    p.fill(200, 220, 255, 100);
                } else { // open
                    p.stroke(200, 100, 0);
                    p.strokeWeight(4);
                    p.fill(255, 230, 200, 100);
                    // Draw inlet and outlet
                    p.fill(150, 200, 255);
                    p.rect(150, 230, 50, 40); // inlet
                    p.fill(255, 150, 150);
                    p.rect(700, 230, 50, 40); // outlet
                }

                p.rect(200, 150, 500, 200);

                // Label
                p.noStroke();
                p.fill(0);
                p.textSize(18);
                p.textAlign(p.CENTER, p.TOP);
                let label = systemType === 'open' ? 'OPEN SYSTEM' :
                           systemType === 'closed' ? 'CLOSED SYSTEM' : 'ISOLATED SYSTEM';
                p.text(label, 450, 120);
            }

            function updateAndDrawParticles() {
                for (let part of particles) {
                    // Update position
                    part.x += part.vx;
                    part.y += part.vy;

                    // Bounce off walls (for closed and isolated)
                    if (systemType !== 'open') {
                        if (part.x < 200 || part.x > 700) part.vx *= -1;
                        if (part.y < 150 || part.y > 350) part.vy *= -1;
                        part.x = p.constrain(part.x, 200, 700);
                        part.y = p.constrain(part.y, 150, 350);
                    }

                    // Draw particle
                    p.noStroke();
                    p.fill(part.color[0], part.color[1], part.color[2]);
                    p.ellipse(part.x, part.y, part.size, part.size);
                }
            }

            function drawIndicators() {
                // Energy indicator
                p.fill(255, 200, 0);
                p.stroke(0);
                p.strokeWeight(2);
                let energyHeight = p.map(systemEnergy, 0, 200, 0, 150);
                p.rect(50, 350 - energyHeight, 40, energyHeight);
                p.noStroke();
                p.fill(0);
                p.textSize(12);
                p.textAlign(p.CENTER, p.BOTTOM);
                p.text('Energy', 70, 370);
                p.text(systemEnergy.toFixed(0) + ' kJ', 70, 390);

                // Mass indicator
                p.fill(100, 150, 255);
                p.stroke(0);
                p.strokeWeight(2);
                let massHeight = p.map(systemMass, 0, 20, 0, 150);
                p.rect(810, 350 - massHeight, 40, massHeight);
                p.noStroke();
                p.fill(0);
                p.textAlign(p.CENTER, p.BOTTOM);
                p.text('Mass', 830, 370);
                p.text(systemMass.toFixed(1) + ' kg', 830, 390);
            }

            function drawTransferArrows() {
                // Heat input arrow (top)
                if (systemType !== 'isolated' && heatInput > 0) {
                    p.stroke(255, 0, 0);
                    p.strokeWeight(3);
                    drawArrow(450, 80, 450, 140, 10);
                    p.noStroke();
                    p.fill(255, 0, 0);
                    p.textAlign(p.CENTER, p.BOTTOM);
                    p.text('Heat In: ' + heatInput + ' kW', 450, 75);
                }

                // Work output arrow (right)
                if (systemType !== 'isolated' && workOutput > 0) {
                    p.stroke(0, 150, 0);
                    p.strokeWeight(3);
                    drawArrow(710, 250, 770, 250, 10);
                    p.noStroke();
                    p.fill(0, 150, 0);
                    p.textAlign(p.LEFT, p.CENTER);
                    p.text('Work: ' + workOutput + ' kW', 775, 250);
                }

                // Mass flow arrows (for open system)
                if (systemType === 'open' && massFlow > 0) {
                    p.stroke(0, 0, 255);
                    p.strokeWeight(3);
                    // Inlet
                    drawArrow(130, 250, 190, 250, 10);
                    p.noStroke();
                    p.fill(0, 0, 255);
                    p.textAlign(p.RIGHT, p.CENTER);
                    p.text('ṁ = ' + massFlow.toFixed(1) + ' kg/s', 125, 250);

                    // Outlet
                    p.stroke(0, 0, 255);
                    p.strokeWeight(3);
                    drawArrow(710, 250, 770, 250, 10);
                }
            }

            function drawArrow(x1, y1, x2, y2, arrowSize) {
                p.line(x1, y1, x2, y2);
                let angle = p.atan2(y2 - y1, x2 - x1);
                p.push();
                p.translate(x2, y2);
                p.rotate(angle);
                p.line(0, 0, -arrowSize, -arrowSize / 2);
                p.line(0, 0, -arrowSize, arrowSize / 2);
                p.pop();
            }

            function drawInfobox() {
                // Draw semi-transparent info box in top-right corner
                let boxWidth = 320;
                let boxHeight = 150;
                let boxX = p.width - boxWidth - 15;
                let boxY = 15;

                // Background
                p.fill(255, 255, 255, 230);
                p.stroke(100);
                p.strokeWeight(1);
                p.rect(boxX, boxY, boxWidth, boxHeight, 5);

                // Title
                p.fill(0);
                p.noStroke();
                p.textAlign(p.LEFT, p.TOP);
                p.textSize(13);
                p.textStyle(p.BOLD);
                p.text('System Status:', boxX + 10, boxY + 10);

                // Content
                p.textStyle(p.NORMAL);
                p.textSize(11);
                let yPos = boxY + 30;
                let lineHeight = 20;

                if (statusTitle) {
                    p.textStyle(p.BOLD);
                    p.text(statusTitle, boxX + 10, yPos);
                    yPos += lineHeight;
                    p.textStyle(p.NORMAL);
                    p.text(massTransfer, boxX + 10, yPos);
                    yPos += lineHeight;
                    p.text(energyTransfer, boxX + 10, yPos);
                    yPos += lineHeight;
                    p.text(statusLine1, boxX + 10, yPos);
                    yPos += lineHeight;
                    p.text(statusLine2, boxX + 10, yPos);
                } else {
                    p.text('Click a system type to begin simulation...', boxX + 10, yPos);
                }
            }

            function updateSystemStatus() {
                if (systemType === 'open') {
                    statusTitle = 'Open System (Control Volume)';
                    massTransfer = 'Mass Transfer: YES';
                    energyTransfer = 'Energy Transfer: YES';
                    statusLine1 = 'Mass flow in = Mass flow out (steady state)';
                    statusLine2 = 'Energy can change due to heat and work transfer';
                } else if (systemType === 'closed') {
                    statusTitle = 'Closed System (Control Mass)';
                    massTransfer = 'Mass Transfer: NO';
                    energyTransfer = 'Energy Transfer: YES';
                    statusLine1 = 'Mass remains constant';
                    statusLine2 = 'Energy changes due to heat and work transfer';
                } else {
                    statusTitle = 'Isolated System';
                    massTransfer = 'Mass Transfer: NO';
                    energyTransfer = 'Energy Transfer: NO';
                    statusLine1 = 'Both mass and energy remain constant';
                    statusLine2 = 'Entropy can only increase (2nd law)';
                }
            }

        }, 'sketch-holder');

        // Quiz submission
        document.getElementById('submit-quiz').addEventListener('click', function() {
            const answers = {
                q1: 'b',
                q2: 'b',
                q3: 'c',
                q4: 'b',
                q5: 'b',
                q6: 'b',
                q7: 'b'
            };

            submitQuiz(
                Object.entries(answers).map(([name, correct]) => ({name, correctAnswer: correct})),
                'quiz-results'
            );
        });
    </script>
</body>
</html>