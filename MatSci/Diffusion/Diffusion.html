<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffusion in Solids - Interactive Lecture</title>

    <!-- Import p5.js for simulations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

    <!-- Import MathJax for equations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/problems.css">
    <link rel="stylesheet" href="/assets/css/quizzes.css">
    <link rel="stylesheet" href="/assets/css/simulations.css">
    <link rel="stylesheet" href="/assets/css/uicontrols.css">

    <style>
        .diffusion-viz {
            background: linear-gradient(to right, #ff6b6b, #4ecdc4);
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1>Diffusion in Solids</h1>
        <p class="subtitle">Mass Transport at the Atomic Level - Interactive Lecture</p>
    </header>

    <div class="content-section">
        <h2>What is Diffusion?</h2>
        <div class="key-point">
            <p><strong>Diffusion</strong> is the net movement of atoms from regions of high concentration to regions of low concentration through random atomic motion. It is the fundamental mechanism by which materials mix, react, and change composition at elevated temperatures.</p>
        </div>

        <p>Diffusion is driven by:</p>
        <ul>
            <li><strong>Concentration gradient:</strong> Atoms move from high to low concentration</li>
            <li><strong>Thermal energy:</strong> Temperature provides energy for atomic movement</li>
            <li><strong>Crystal defects:</strong> Vacancies and interstitials enable atomic migration</li>
        </ul>

        <h3>Why Diffusion Matters:</h3>
        <ul>
            <li>Heat treatment of alloys (carburizing, nitriding)</li>
            <li>Semiconductor doping in electronics</li>
            <li>High-temperature creep and component failure</li>
            <li>Welding and bonding processes</li>
            <li>Oxidation and corrosion</li>
        </ul>
    </div>

    <div class="content-section">
        <h2>Fundamental Concepts</h2>

        <h3>1. Fick's First Law (Steady-State Diffusion)</h3>
        <div class="equation-box">
            <p>For steady-state conditions where concentration profile doesn't change with time:</p>
            <p>\(J = -D \frac{dC}{dx}\)</p>
            <p>Where:</p>
            <ul>
                <li>\(J\) = diffusion flux (mass per unit area per unit time) [kg/(m²·s)]</li>
                <li>\(D\) = diffusion coefficient (diffusivity) [m²/s]</li>
                <li>\(\frac{dC}{dx}\) = concentration gradient [kg/m⁴]</li>
                <li>Negative sign indicates flux from high to low concentration</li>
            </ul>
        </div>

        <h3>2. Fick's Second Law (Non-Steady-State Diffusion)</h3>
        <div class="equation-box">
            <p>For time-dependent concentration changes:</p>
            <p>\(\frac{\partial C}{\partial t} = D \frac{\partial^2 C}{\partial x^2}\)</p>
            <p>This is the diffusion equation, showing how concentration changes with time.</p>
            <p>For constant surface concentration and semi-infinite solid:</p>
            <p>\(\frac{C_x - C_0}{C_s - C_0} = 1 - \text{erf}\left(\frac{x}{2\sqrt{Dt}}\right)\)</p>
            <p>Where:</p>
            <ul>
                <li>\(C_x\) = concentration at depth x and time t</li>
                <li>\(C_0\) = initial concentration in the solid</li>
                <li>\(C_s\) = constant surface concentration</li>
                <li>\(\text{erf}\) = error function</li>
                <li>\(x\) = distance from surface [m]</li>
                <li>\(t\) = time [s]</li>
            </ul>
        </div>

        <h3>3. Temperature Dependence (Arrhenius Equation)</h3>
        <div class="equation-box">
            <p>The diffusion coefficient varies exponentially with temperature:</p>
            <p>\(D = D_0 \exp\left(-\frac{Q_d}{RT}\right)\)</p>
            <p>Where:</p>
            <ul>
                <li>\(D_0\) = pre-exponential constant [m²/s]</li>
                <li>\(Q_d\) = activation energy for diffusion [J/mol]</li>
                <li>\(R\) = universal gas constant = 8.314 J/(mol·K)</li>
                <li>\(T\) = absolute temperature [K]</li>
            </ul>
            <p>Taking the natural logarithm:</p>
            <p>\(\ln(D) = \ln(D_0) - \frac{Q_d}{RT}\)</p>
            <p>This gives a linear relationship when plotting ln(D) vs 1/T</p>
        </div>

        <h3>4. Diffusion Mechanisms</h3>
        <div class="key-point">
            <ul>
                <li><strong>Vacancy Diffusion:</strong> Atoms move by jumping into adjacent vacant lattice sites (most common in substitutional alloys)</li>
                <li><strong>Interstitial Diffusion:</strong> Small atoms move through interstitial spaces between lattice atoms (much faster than vacancy diffusion)</li>
                <li><strong>Grain Boundary Diffusion:</strong> Enhanced diffusion along grain boundaries</li>
                <li><strong>Surface Diffusion:</strong> Very rapid diffusion along free surfaces</li>
            </ul>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation: Atomic Diffusion Visualization</h2>
        <p>Watch atoms diffuse from high concentration (left) to low concentration (right). Adjust temperature to see how it affects diffusion rate!</p>

        <div id="sketch-holder-diffusion"></div>

        <div class="simulation-controls">
            <div class="slider-container">
                <label>Temperature: <span id="temp-value" class="slider-value">800</span> K</label>
                <input type="range" id="temp-slider" min="300" max="1200" step="50" value="800">
            </div>
            <div class="slider-container">
                <label>Initial Concentration Gradient: <span id="gradient-value" class="slider-value">High</span></label>
                <input type="range" id="gradient-slider" min="1" max="3" step="1" value="2">
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <button id="start-diffusion">START</button>
                <button id="reset-diffusion">RESET</button>
            </div>
        </div>
    </div>

    <div class="simulation-section">
        <h2>Interactive Simulation: Carburizing Process</h2>
        <p>Simulate the carburizing process where carbon diffuses into steel. See how depth of penetration changes with time and temperature!</p>

        <div id="sketch-holder-carburizing"></div>

        <div class="simulation-controls">
            <div class="control-row">
                <div class="control-column">
                    <div class="slider-container">
                        <label>Temperature: <span id="carb-temp-value" class="slider-value">927</span> °C (1200 K)</label>
                        <input type="range" id="carb-temp-slider" min="800" max="1050" step="10" value="927">
                    </div>
                    <div class="slider-container">
                        <label>Time: <span id="carb-time-value" class="slider-value">10</span> hours</label>
                        <input type="range" id="carb-time-slider" min="1" max="50" step="1" value="10">
                    </div>
                </div>
                <div class="control-column">
                    <div id="carb-info" style="padding: 10px; background: #f0f0f0; border-radius: 5px;">
                        <h4 style="margin-top: 0;">Carburizing Data:</h4>
                        <div id="carb-details"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Engineering Applications</h2>

        <h3>Heat Treatment Processes</h3>
        <ul>
            <li><strong>Carburizing:</strong> Diffusing carbon into low-carbon steel surface for hard, wear-resistant case</li>
            <li><strong>Nitriding:</strong> Diffusing nitrogen into steel for surface hardness and corrosion resistance</li>
            <li><strong>Decarburizing:</strong> Removing carbon from steel surface (often unwanted during heat treatment)</li>
            <li><strong>Homogenization:</strong> Reducing composition gradients in cast alloys</li>
        </ul>

        <h3>Semiconductor Manufacturing</h3>
        <ul>
            <li><strong>Doping:</strong> Diffusing dopants (P, B, As) into silicon to create p-n junctions</li>
            <li><strong>Drive-in:</strong> Redistributing dopants to achieve desired concentration profiles</li>
            <li><strong>Oxidation:</strong> Growing SiO₂ layers where oxygen diffuses into silicon</li>
        </ul>

        <h3>High-Temperature Applications</h3>
        <ul>
            <li><strong>Creep Resistance:</strong> Controlling grain boundary diffusion in turbine blades</li>
            <li><strong>Coating Degradation:</strong> Interdiffusion between coating and substrate</li>
            <li><strong>Sintering:</strong> Densification of powder compacts through diffusion</li>
        </ul>

        <h3>Failure Analysis</h3>
        <ul>
            <li><strong>Hydrogen Embrittlement:</strong> Hydrogen diffusion into steel causing brittleness</li>
            <li><strong>Kirkendall Effect:</strong> Void formation due to unequal diffusion rates</li>
            <li><strong>Oxidation:</strong> Oxygen diffusion into metals forming oxide scales</li>
        </ul>

        <div class="key-point">
            <p><strong>Engineering Insight:</strong> The diffusion distance scales with √(Dt), meaning doubling the diffusion depth requires 4× the time. This square-root time dependence is critical for process planning in heat treatment and semiconductor fabrication.</p>
        </div>
    </div>

    <div class="content-section">
        <h2>Summary of Key Equations</h2>
        <div class="equation-table">
            <table>
                <thead>
                    <tr>
                        <th>Concept</th>
                        <th>Equation</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Fick's First Law</td>
                    <td>\(J = -D \frac{dC}{dx}\)</td>
                    <td>Steady-state diffusion flux</td>
                </tr>
                <tr>
                    <td>Fick's Second Law</td>
                    <td>\(\frac{\partial C}{\partial t} = D \frac{\partial^2 C}{\partial x^2}\)</td>
                    <td>Non-steady-state diffusion</td>
                </tr>
                <tr>
                    <td>Arrhenius Equation</td>
                    <td>\(D = D_0 \exp\left(-\frac{Q_d}{RT}\right)\)</td>
                    <td>Temperature dependence of D</td>
                </tr>
                <tr>
                    <td>Diffusion Solution</td>
                    <td>\(\frac{C_x - C_0}{C_s - C_0} = 1 - \text{erf}\left(\frac{x}{2\sqrt{Dt}}\right)\)</td>
                    <td>Concentration profile (constant surface)</td>
                </tr>
                <tr>
                    <td>Diffusion Distance</td>
                    <td>\(x \propto \sqrt{Dt}\)</td>
                    <td>Characteristic penetration depth</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-section">
        <h2>Practice Problems</h2>

        <div class="practice-problems">
            <h3>Problem 1: Carburizing Depth Calculation</h3>
            <p>A steel component is carburized at 927°C (1200 K) for 10 hours. The diffusion coefficient of carbon in steel at this temperature is D = 2.0 × 10⁻¹¹ m²/s. Calculate the depth at which the carbon concentration is the average of the surface and initial concentrations (this occurs when erf(z) = 0.5, where z ≈ 0.48).</p>

            <p class="toggle-section" onclick="toggleSolution('solution1')">Show Solution</p>
            <div id="solution1" class="hidden">
                <p>Given: \(D = 2.0 \times 10^{-11}\) m²/s, \(t = 10\) hours = 36,000 s</p>

                <p>We need to find x where \(\text{erf}\left(\frac{x}{2\sqrt{Dt}}\right) = 0.5\)</p>
                <p>This occurs when \(\frac{x}{2\sqrt{Dt}} = 0.48\)</p>

                <p><strong>Calculate \(\sqrt{Dt}\):</strong></p>
                <p>\(\sqrt{Dt} = \sqrt{2.0 \times 10^{-11} \times 36000}\)</p>
                <p>\(\sqrt{Dt} = \sqrt{7.2 \times 10^{-7}} = 8.49 \times 10^{-4}\) m</p>

                <p><strong>Calculate depth x:</strong></p>
                <p>\(x = 2 \times 0.48 \times 8.49 \times 10^{-4}\)</p>
                <p>\(x = 8.15 \times 10^{-4}\) m = <strong>0.815 mm</strong></p>

                <p>The carbon concentration is half-way between surface and initial values at a depth of approximately 0.8 mm.</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 2: Temperature Effect on Diffusion</h3>
            <p>The diffusion coefficient of copper in aluminum is D = 6.5 × 10⁻¹³ m²/s at 500°C. The activation energy for this diffusion is Q_d = 136 kJ/mol. Calculate the diffusion coefficient at 600°C. How many times faster is diffusion at 600°C compared to 500°C?</p>

            <p class="toggle-section" onclick="toggleSolution('solution2')">Show Solution</p>
            <div id="solution2" class="hidden">
                <p>Given: \(D_1 = 6.5 \times 10^{-13}\) m²/s at \(T_1 = 773\) K (500°C)</p>
                <p>\(Q_d = 136,000\) J/mol, \(R = 8.314\) J/(mol·K), \(T_2 = 873\) K (600°C)</p>

                <p><strong>Using the Arrhenius equation ratio:</strong></p>
                <p>\(\frac{D_2}{D_1} = \exp\left[\frac{Q_d}{R}\left(\frac{1}{T_1} - \frac{1}{T_2}\right)\right]\)</p>

                <p>\(\frac{D_2}{D_1} = \exp\left[\frac{136000}{8.314}\left(\frac{1}{773} - \frac{1}{873}\right)\right]\)</p>

                <p>\(\frac{D_2}{D_1} = \exp\left[16354 \times (0.001294 - 0.001146)\right]\)</p>

                <p>\(\frac{D_2}{D_1} = \exp[16354 \times 0.000148] = \exp[2.42] = 11.2\)</p>

                <p><strong>Calculate D₂:</strong></p>
                <p>\(D_2 = 11.2 \times 6.5 \times 10^{-13} = 7.28 \times 10^{-12}\) m²/s</p>

                <p>Diffusion at 600°C is approximately <strong>11 times faster</strong> than at 500°C.</p>
            </div>
        </div>

        <div class="practice-problems">
            <h3>Problem 3: Diffusion Time Scaling</h3>
            <p>A carburizing process achieves a penetration depth of 1.0 mm in 5 hours at a certain temperature. How long would it take to achieve a penetration depth of 2.5 mm at the same temperature?</p>

            <p class="toggle-section" onclick="toggleSolution('solution3')">Show Solution</p>
            <div id="solution3" class="hidden">
                <p>The characteristic diffusion distance scales as \(x \propto \sqrt{Dt}\)</p>
                <p>At constant temperature and D:</p>
                <p>\(\frac{x_2}{x_1} = \sqrt{\frac{t_2}{t_1}}\)</p>

                <p>Given: \(x_1 = 1.0\) mm, \(t_1 = 5\) hours, \(x_2 = 2.5\) mm</p>

                <p><strong>Solve for t₂:</strong></p>
                <p>\(\frac{2.5}{1.0} = \sqrt{\frac{t_2}{5}}\)</p>

                <p>\(2.5 = \sqrt{\frac{t_2}{5}}\)</p>

                <p>Squaring both sides:</p>
                <p>\(6.25 = \frac{t_2}{5}\)</p>

                <p>\(t_2 = 6.25 \times 5 = 31.25\) hours</p>

                <p>To increase penetration depth by 2.5×, the time must increase by <strong>(2.5)² = 6.25×</strong></p>
            </div>
        </div>
    </div>

    <div class="content-section">
        <h2>Knowledge Check Quiz</h2>
        <div class="quiz-container">
            <div class="quiz-question">
                <h3>Question 1: What does the negative sign in Fick's First Law indicate?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> a) Diffusion only occurs at negative temperatures</label>
                    <label><input type="radio" name="q1" value="b"> b) The diffusion coefficient is always negative</label>
                    <label><input type="radio" name="q1" value="c"> c) Atoms flow from high to low concentration</label>
                    <label><input type="radio" name="q1" value="d"> d) The concentration gradient is always negative</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 2: How does the diffusion coefficient D change with increasing temperature?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> a) Decreases exponentially</label>
                    <label><input type="radio" name="q2" value="b"> b) Increases exponentially</label>
                    <label><input type="radio" name="q2" value="c"> c) Remains constant</label>
                    <label><input type="radio" name="q2" value="d"> d) Increases linearly</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 3: Which diffusion mechanism is typically fastest?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> a) Vacancy diffusion</label>
                    <label><input type="radio" name="q3" value="b"> b) Interstitial diffusion</label>
                    <label><input type="radio" name="q3" value="c"> c) Grain boundary diffusion</label>
                    <label><input type="radio" name="q3" value="d"> d) They all have the same rate</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 4: If you want to double the diffusion penetration depth at constant temperature, by what factor must you increase the time?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> a) 2</label>
                    <label><input type="radio" name="q4" value="b"> b) 4</label>
                    <label><input type="radio" name="q4" value="c"> c) 8</label>
                    <label><input type="radio" name="q4" value="d"> d) Square root of 2</label>
                </div>
            </div>

            <div class="quiz-question">
                <h3>Question 5: Fick's Second Law applies to which type of diffusion?</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> a) Steady-state diffusion only</label>
                    <label><input type="radio" name="q5" value="b"> b) Non-steady-state (time-dependent) diffusion</label>
                    <label><input type="radio" name="q5" value="c"> c) Surface diffusion only</label>
                    <label><input type="radio" name="q5" value="d"> d) Grain boundary diffusion only</label>
                </div>
            </div>

            <button id="submit-quiz">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <footer>
        <script src="/assets/common/footer.js"></script>
    </footer>

    <!-- Common JavaScript functions -->
    <script src="/assets/common/problems.js"></script>
    <script src="/assets/common/quizzes.js"></script>

    <!-- p5.js sketches -->
    <script>
        // Atomic Diffusion Visualization
        let diffusionSketch = function(p) {
            let atoms = [];
            let temperature = 800;
            let gradientLevel = 2;
            let running = false;
            let time = 0;

            class Atom {
                constructor(x, y, type) {
                    this.x = x;
                    this.y = y;
                    this.type = type;
                    this.vx = 0;
                    this.vy = 0;
                }

                update() {
                    if (!running) return;

                    // Random walk (Brownian motion)
                    let speed = p.map(temperature, 300, 1200, 0.2, 2.0);
                    this.vx += p.random(-speed, speed);
                    this.vy += p.random(-speed, speed);

                    // Damping
                    this.vx *= 0.8;
                    this.vy *= 0.8;

                    this.x += this.vx;
                    this.y += this.vy;

                    // Boundary conditions
                    if (this.x < 10) this.x = 10;
                    if (this.x > p.width - 10) this.x = p.width - 10;
                    if (this.y < 10) this.y = 10;
                    if (this.y > p.height - 10) this.y = p.height - 10;
                }

                display() {
                    p.push();
                    p.noStroke();
                    if (this.type === 'A') {
                        p.fill(255, 100, 100, 200);
                    } else {
                        p.fill(100, 100, 255, 200);
                    }
                    p.ellipse(this.x, this.y, 12, 12);
                    p.pop();
                }
            }

            p.setup = function() {
                let canvas = p.createCanvas(800, 400);
                canvas.parent('sketch-holder-diffusion');
                initializeAtoms();
            };

            p.draw = function() {
                p.background(240);

                // Draw concentration gradient background
                for (let x = 0; x < p.width; x += 10) {
                    let concA = getConcentration(x);
                    p.fill(255, 100 - concA * 100, 100 - concA * 100, 30);
                    p.noStroke();
                    p.rect(x, 0, 10, p.height);
                }

                // Update and draw atoms
                for (let atom of atoms) {
                    atom.update();
                    atom.display();
                }

                // Draw dividing line
                p.stroke(150);
                p.strokeWeight(2);
                p.drawingContext.setLineDash([10, 10]);
                p.line(p.width / 2, 0, p.width / 2, p.height);
                p.drawingContext.setLineDash([]);

                // Calculate actual concentrations
                let leftCount = 0, rightCount = 0;
                for (let atom of atoms) {
                    if (atom.type === 'A') {
                        if (atom.x < p.width / 2) leftCount++;
                        else rightCount++;
                    }
                }
                let totalA = leftCount + rightCount;

                // Display info
                p.fill(0);
                p.noStroke();
                p.textAlign(p.LEFT);
                p.textSize(14);
                p.text(`Temperature: ${temperature} K`, 10, 25);
                p.text(`Time: ${time.toFixed(1)} s`, 10, 45);
                p.textAlign(p.CENTER);
                p.text(`Type A (left): ${((leftCount/totalA)*100).toFixed(0)}%`, p.width/4, p.height - 15);
                p.text(`Type A (right): ${((rightCount/totalA)*100).toFixed(0)}%`, 3*p.width/4, p.height - 15);

                if (running) {
                    time += 0.05;
                }

                // Legend
                p.textAlign(p.RIGHT);
                p.fill(255, 100, 100);
                p.ellipse(p.width - 110, 25, 12, 12);
                p.fill(0);
                p.text('Type A atoms', p.width - 10, 30);
                p.fill(100, 100, 255);
                p.ellipse(p.width - 110, 45, 12, 12);
                p.fill(0);
                p.text('Type B atoms', p.width - 10, 50);
            };

            function initializeAtoms() {
                atoms = [];
                let numAtomsA = 100 * gradientLevel;
                let numAtomsB = 50;

                // Type A atoms (initially on left)
                for (let i = 0; i < numAtomsA; i++) {
                    let x = p.random(10, p.width / 2 - 10);
                    let y = p.random(10, p.height - 10);
                    atoms.push(new Atom(x, y, 'A'));
                }

                // Type B atoms (distributed)
                for (let i = 0; i < numAtomsB; i++) {
                    let x = p.random(10, p.width - 10);
                    let y = p.random(10, p.height - 10);
                    atoms.push(new Atom(x, y, 'B'));
                }
            }

            function getConcentration(x) {
                let countA = 0;
                let sampleWidth = 50;
                for (let atom of atoms) {
                    if (atom.type === 'A' && Math.abs(atom.x - x) < sampleWidth) {
                        countA++;
                    }
                }
                return p.constrain(countA / 50, 0, 1);
            }

            window.updateDiffTemp = function(temp) {
                temperature = parseFloat(temp);
            };

            window.updateGradient = function(grad) {
                gradientLevel = parseInt(grad);
                if (!running) initializeAtoms();
            };

            window.startDiffusion = function() {
                running = true;
            };

            window.resetDiffusion = function() {
                running = false;
                time = 0;
                initializeAtoms();
            };
        };

        // Carburizing Process Simulation
        let carburizingSketch = function(p) {
            let temperature = 927; // Celsius
            let time_hours = 10;
            let D = 2.0e-11; // m²/s at 927°C

            p.setup = function() {
                let canvas = p.createCanvas(800, 400);
                canvas.parent('sketch-holder-carburizing');
                p.textFont('Arial');
            };

            p.draw = function() {
                p.background(250);

                // Update D based on temperature (simplified Arrhenius)
                let T_kelvin = temperature + 273;
                let Q_d = 148000; // J/mol for C in γ-Fe
                let D_0 = 2.3e-5; // m²/s
                let R = 8.314;
                D = D_0 * Math.exp(-Q_d / (R * T_kelvin));

                // Draw axes
                p.stroke(0);
                p.strokeWeight(2);
                p.line(100, 350, 750, 350); // x-axis
                p.line(100, 350, 100, 50);  // y-axis

                // Labels
                p.fill(0);
                p.noStroke();
                p.textAlign(p.CENTER);
                p.textSize(14);
                p.text('Distance from Surface (mm)', 425, 390);
                p.push();
                p.translate(30, 200);
                p.rotate(-p.PI/2);
                p.text('Carbon Concentration (wt%)', 0, 0);
                p.pop();

                // Draw concentration profile
                let C_s = 1.2; // Surface concentration (wt% C)
                let C_0 = 0.2; // Initial concentration (wt% C)
                let t_seconds = time_hours * 3600;

                p.noFill();
                p.stroke(255, 0, 0);
                p.strokeWeight(3);
                p.beginShape();
                for (let x_mm = 0; x_mm <= 5; x_mm += 0.1) {
                    let x_m = x_mm / 1000;
                    let z = x_m / (2 * Math.sqrt(D * t_seconds));
                    let erf_z = erfApprox(z);
                    let C_x = C_0 + (C_s - C_0) * (1 - erf_z);

                    let screenX = p.map(x_mm, 0, 5, 100, 750);
                    let screenY = p.map(C_x, 0, 1.5, 350, 50);
                    p.vertex(screenX, screenY);
                }
                p.endShape();

                // Draw tick marks
                p.stroke(0);
                p.strokeWeight(1);
                p.fill(0);
                p.textSize(12);
                for (let x = 0; x <= 5; x += 1) {
                    let screenX = p.map(x, 0, 5, 100, 750);
                    p.line(screenX, 350, screenX, 355);
                    p.text(x, screenX, 370);
                }
                for (let c = 0; c <= 1.5; c += 0.3) {
                    let screenY = p.map(c, 0, 1.5, 350, 50);
                    p.line(95, screenY, 100, screenY);
                    p.text(c.toFixed(1), 70, screenY + 5);
                }

                // Calculate case depth (depth where C = 0.4 wt%)
                let target_C = 0.4;
                let case_depth = findDepth(C_s, C_0, target_C, D, t_seconds);

                // Update info panel
                let infoText = `<strong>Diffusion Coefficient:</strong> ${D.toExponential(2)} m²/s<br>`;
                infoText += `<strong>√(Dt):</strong> ${Math.sqrt(D * t_seconds).toExponential(2)} m<br>`;
                infoText += `<strong>Case Depth (0.4% C):</strong> ${(case_depth * 1000).toFixed(2)} mm`;
                document.getElementById('carb-details').innerHTML = infoText;
            };

            function erfApprox(z) {
                // Approximation of error function
                if (z < 0) return -erfApprox(-z);
                if (z > 4) return 1.0;

                let a1 = 0.254829592;
                let a2 = -0.284496736;
                let a3 = 1.421413741;
                let a4 = -1.453152027;
                let a5 = 1.061405429;
                let p = 0.3275911;

                let t = 1.0 / (1.0 + p * z);
                let y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);
                return y;
            }

            function findDepth(C_s, C_0, C_target, D, t) {
                // Binary search to find depth where concentration = C_target
                let depth = 0;
                for (let x_mm = 0.1; x_mm <= 10; x_mm += 0.01) {
                    let x_m = x_mm / 1000;
                    let z = x_m / (2 * Math.sqrt(D * t));
                    let C_x = C_0 + (C_s - C_0) * (1 - erfApprox(z));
                    if (C_x <= C_target) {
                        depth = x_m;
                        break;
                    }
                }
                return depth;
            }

            window.updateCarbTemp = function(temp) {
                temperature = parseFloat(temp);
            };

            window.updateCarbTime = function(hrs) {
                time_hours = parseFloat(hrs);
            };
        };

        // Create p5 instances
        new p5(diffusionSketch);
        new p5(carburizingSketch);

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Diffusion simulation controls
            const tempSlider = document.getElementById('temp-slider');
            const gradientSlider = document.getElementById('gradient-slider');

            tempSlider.addEventListener('input', e => {
                document.getElementById('temp-value').textContent = e.target.value;
                window.updateDiffTemp(e.target.value);
            });

            gradientSlider.addEventListener('input', e => {
                let labels = ['Low', 'Medium', 'High'];
                document.getElementById('gradient-value').textContent = labels[parseInt(e.target.value) - 1];
                window.updateGradient(e.target.value);
            });

            document.getElementById('start-diffusion').addEventListener('click', window.startDiffusion);
            document.getElementById('reset-diffusion').addEventListener('click', window.resetDiffusion);

            // Carburizing controls
            const carbTempSlider = document.getElementById('carb-temp-slider');
            const carbTimeSlider = document.getElementById('carb-time-slider');

            carbTempSlider.addEventListener('input', e => {
                let tempC = parseInt(e.target.value);
                let tempK = tempC + 273;
                document.getElementById('carb-temp-value').textContent = `${tempC} °C (${tempK} K)`;
                window.updateCarbTemp(e.target.value);
            });

            carbTimeSlider.addEventListener('input', e => {
                document.getElementById('carb-time-value').textContent = e.target.value;
                window.updateCarbTime(e.target.value);
            });

            // Quiz
            document.getElementById('submit-quiz').addEventListener('click', function() {
                const answers = {
                    q1: 'c',
                    q2: 'b',
                    q3: 'b',
                    q4: 'b',
                    q5: 'b'
                };

                let score = 0;
                let totalQuestions = Object.keys(answers).length;
                let resultsHTML = '<h3>Quiz Results:</h3>';

                for (let question in answers) {
                    const selected = document.querySelector(`input[name="${question}"]:checked`);
                    const correctAnswer = answers[question];

                    if (selected) {
                        if (selected.value === correctAnswer) {
                            score++;
                            resultsHTML += `<p style="color: #28a745; font-weight: bold;">${question.toUpperCase()}: Correct!</p>`;
                        } else {
                            resultsHTML += `<p style="color: #dc3545; font-weight: bold;">${question.toUpperCase()}: Incorrect</p>`;
                        }
                    } else {
                        resultsHTML += `<p style="color: #333;">${question.toUpperCase()}: Not answered</p>`;
                    }
                }

                const percentage = ((score / totalQuestions) * 100).toFixed(0);
                resultsHTML = `<p style="font-size: 1.2em; font-weight: bold;">You scored ${score} out of ${totalQuestions} (${percentage}%)</p>` + resultsHTML;

                document.getElementById('quiz-results').innerHTML = resultsHTML;
            });
        });
    </script>
</body>
</html>
